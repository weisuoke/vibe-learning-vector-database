# è¿­ä»£å™¨ (Iterator)

## 1. ã€30å­—æ ¸å¿ƒã€‘

**è¿­ä»£å™¨æ˜¯å®ç°äº† `__iter__` å’Œ `__next__` æ–¹æ³•çš„å¯¹è±¡ï¼Œæä¾›ç»Ÿä¸€çš„"é€ä¸ªè®¿é—®"æ¥å£ï¼Œæ˜¯ for å¾ªç¯çš„åº•å±‚æœºåˆ¶ã€‚**

---

## 2. ã€ç¬¬ä¸€æ€§åŸç†ã€‘

### ä»€ä¹ˆæ˜¯ç¬¬ä¸€æ€§åŸç†ï¼Ÿ

**ç¬¬ä¸€æ€§åŸç†**ï¼šå›åˆ°äº‹ç‰©æœ€åŸºæœ¬çš„çœŸç†ï¼Œä»æºå¤´æ€è€ƒé—®é¢˜

### è¿­ä»£å™¨çš„ç¬¬ä¸€æ€§åŸç† ğŸ¯

#### 1. æœ€åŸºç¡€çš„å®šä¹‰

**è¿­ä»£å™¨ = èƒ½ä¸€ä¸ªä¸€ä¸ªå–å‡ºå…ƒç´ çš„å¯¹è±¡**

ä»…æ­¤è€Œå·²ï¼æ²¡æœ‰æ›´åŸºç¡€çš„äº†ã€‚

åªè¦ä¸€ä¸ªå¯¹è±¡èƒ½ï¼š
1. è¿”å›è‡ªå·±ï¼ˆ`__iter__`ï¼‰
2. è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ˆ`__next__`ï¼‰

å®ƒå°±æ˜¯è¿­ä»£å™¨ã€‚

#### 2. ä¸ºä»€ä¹ˆéœ€è¦è¿­ä»£å™¨ï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šä¸åŒçš„æ•°æ®ç»“æ„ï¼ˆåˆ—è¡¨ã€å­—å…¸ã€æ–‡ä»¶ã€è‡ªå®šä¹‰å¯¹è±¡ï¼‰ï¼Œå¦‚ä½•ç”¨ç»Ÿä¸€çš„æ–¹å¼è®¿é—®å®ƒä»¬çš„å…ƒç´ ï¼Ÿ**

æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼š
- ä½ æœ‰åˆ—è¡¨ `[1, 2, 3]`
- ä½ æœ‰å­—å…¸ `{'a': 1, 'b': 2}`
- ä½ æœ‰æ–‡ä»¶å¯¹è±¡
- ä½ æœ‰è‡ªå®šä¹‰çš„æ•°æ®åº“æŸ¥è¯¢ç»“æœ

å¦‚æœæ¯ç§ç±»å‹éƒ½è¦å†™ä¸åŒçš„éå†ä»£ç ï¼Œå¤ªéº»çƒ¦äº†ï¼

```python
# æ²¡æœ‰è¿­ä»£å™¨çš„ä¸–ç•Œï¼ˆå‡è®¾ï¼‰
for i in range(len(my_list)):
    print(my_list[i])

for key in dict.keys():
    print(dict[key])

line = file.readline()
while line:
    print(line)
    line = file.readline()

# æœ‰äº†è¿­ä»£å™¨
for item in my_list:
    print(item)

for item in my_dict:
    print(item)

for line in file:
    print(line)
```

#### 3. è¿­ä»£å™¨çš„ä¸‰å±‚ä»·å€¼

##### ä»·å€¼1ï¼šç»Ÿä¸€æ¥å£
æ‰€æœ‰å¯è¿­ä»£å¯¹è±¡éƒ½æ”¯æŒç›¸åŒçš„ for å¾ªç¯è¯­æ³•ã€‚

```python
# åŒæ ·çš„è¯­æ³•ï¼Œé€‚ç”¨äºä»»ä½•å¯è¿­ä»£å¯¹è±¡
for item in [1, 2, 3]:       # åˆ—è¡¨
    print(item)

for char in "hello":          # å­—ç¬¦ä¸²
    print(char)

for key in {'a': 1, 'b': 2}:  # å­—å…¸
    print(key)

for line in open('file.txt'): # æ–‡ä»¶
    print(line)
```

##### ä»·å€¼2ï¼šæƒ°æ€§æ±‚å€¼
è¿­ä»£å™¨ä¸éœ€è¦ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®ï¼Œå¯ä»¥æŒ‰éœ€è·å–ã€‚

```python
# è¿­ä»£å™¨åªåœ¨éœ€è¦æ—¶æ‰è®¡ç®—/è·å–ä¸‹ä¸€ä¸ªå…ƒç´ 
huge_file = open('10GB_file.txt')
for line in huge_file:  # ä¸€æ¬¡åªè¯»ä¸€è¡Œï¼Œå†…å­˜å‹å¥½
    process(line)
```

##### ä»·å€¼3ï¼šè§£è€¦æ•°æ®å’Œéå†
æ•°æ®å­˜å‚¨å’Œéå†é€»è¾‘åˆ†ç¦»ï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚

```python
class VectorCollection:
    """å‘é‡é›†åˆï¼šå­˜å‚¨é€»è¾‘"""
    def __init__(self):
        self.vectors = []
    
    def __iter__(self):
        return VectorIterator(self.vectors)

class VectorIterator:
    """å‘é‡è¿­ä»£å™¨ï¼šéå†é€»è¾‘"""
    def __init__(self, vectors):
        self.vectors = vectors
        self.index = 0
    
    def __next__(self):
        if self.index >= len(self.vectors):
            raise StopIteration
        value = self.vectors[self.index]
        self.index += 1
        return value
    
    def __iter__(self):
        return self
```

#### 4. ä»ç¬¬ä¸€æ€§åŸç†æ¨å¯¼å‘é‡æ•°æ®åº“åº”ç”¨

**æ¨ç†é“¾ï¼š**
```
1. å‘é‡æ•°æ®åº“å­˜å‚¨æµ·é‡å‘é‡
   â†“
2. ä¸èƒ½ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜
   â†“
3. éœ€è¦"æŒ‰éœ€è·å–"çš„æœºåˆ¶
   â†“
4. è¿­ä»£å™¨æä¾›ç»Ÿä¸€çš„"é€ä¸ªè®¿é—®"æ¥å£
   â†“
5. åº”ç”¨ï¼šåˆ†é¡µæŸ¥è¯¢ã€æµå¼å¯¼å‡ºã€æ‰¹é‡å¤„ç†
```

```python
class VectorDBCursor:
    """å‘é‡æ•°æ®åº“æ¸¸æ ‡ï¼šè¿­ä»£å™¨å®ç°"""
    def __init__(self, collection, query, batch_size=100):
        self.collection = collection
        self.query = query
        self.batch_size = batch_size
        self.offset = 0
        self.buffer = []
        self.exhausted = False
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if not self.buffer and not self.exhausted:
            # ä»æ•°æ®åº“è·å–ä¸‹ä¸€æ‰¹
            self.buffer = self.collection.query(
                self.query,
                limit=self.batch_size,
                offset=self.offset
            )
            self.offset += self.batch_size
            if len(self.buffer) < self.batch_size:
                self.exhausted = True
        
        if not self.buffer:
            raise StopIteration
        
        return self.buffer.pop(0)

# ä½¿ç”¨ï¼šéå†ç™¾ä¸‡å‘é‡ä¹Ÿä¸ä¼šçˆ†å†…å­˜
for vector in VectorDBCursor(collection, query_vec):
    process(vector)
```

#### 5. ä¸€å¥è¯æ€»ç»“ç¬¬ä¸€æ€§åŸç†

**è¿­ä»£å™¨æ˜¯"ç»Ÿä¸€é€ä¸ªè®¿é—®"çš„æŠ½è±¡ï¼Œè®©ä»»ä½•æ•°æ®ç»“æ„éƒ½èƒ½ç”¨ for å¾ªç¯éå†ï¼Œæ˜¯ Python æœ€åŸºç¡€çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚**

---

## 3. ã€3ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‘

### æ ¸å¿ƒæ¦‚å¿µ1ï¼šè¿­ä»£å™¨åè®® (Iterator Protocol) ğŸ“œ

**è¿­ä»£å™¨åè®®æ˜¯ä¸€ç»„çº¦å®šï¼šå®ç° `__iter__` å’Œ `__next__` æ–¹æ³•ã€‚**

```python
class SimpleIterator:
    """æœ€ç®€å•çš„è¿­ä»£å™¨"""
    def __init__(self, data):
        self.data = data
        self.index = 0
    
    def __iter__(self):
        """è¿”å›è¿­ä»£å™¨è‡ªèº«"""
        return self
    
    def __next__(self):
        """è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰äº†å°±æŠ› StopIteration"""
        if self.index >= len(self.data):
            raise StopIteration
        value = self.data[self.index]
        self.index += 1
        return value

# ä½¿ç”¨
it = SimpleIterator([1, 2, 3])
print(next(it))  # 1
print(next(it))  # 2
print(next(it))  # 3
# print(next(it))  # StopIteration!

# ç”¨ for å¾ªç¯
for item in SimpleIterator(['a', 'b', 'c']):
    print(item)  # a b c
```

**åè®®è¦ç‚¹ï¼š**

| æ–¹æ³• | ä½œç”¨ | è¿”å›å€¼ |
|-----|------|-------|
| `__iter__()` | è¿”å›è¿­ä»£å™¨å¯¹è±¡ | selfï¼ˆè¿­ä»£å™¨è‡ªèº«ï¼‰ |
| `__next__()` | è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´  | å…ƒç´ å€¼ï¼Œæˆ–æŠ› StopIteration |

---

### æ ¸å¿ƒæ¦‚å¿µ2ï¼šå¯è¿­ä»£å¯¹è±¡ vs è¿­ä»£å™¨ ğŸ”„

**å¯è¿­ä»£å¯¹è±¡ (Iterable)ï¼šèƒ½è¿”å›è¿­ä»£å™¨çš„å¯¹è±¡**
**è¿­ä»£å™¨ (Iterator)ï¼šèƒ½é€ä¸ªè¿”å›å…ƒç´ çš„å¯¹è±¡**

```python
# åˆ—è¡¨æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œä¸æ˜¯è¿­ä»£å™¨
my_list = [1, 2, 3]
print(hasattr(my_list, '__iter__'))  # True
print(hasattr(my_list, '__next__'))  # Falseï¼ˆåˆ—è¡¨æ²¡æœ‰ __next__ï¼‰

# è°ƒç”¨ iter() è·å–è¿­ä»£å™¨
my_iterator = iter(my_list)
print(hasattr(my_iterator, '__next__'))  # True

# è¿­ä»£å™¨è‡ªèº«ä¹Ÿæ˜¯å¯è¿­ä»£çš„
print(iter(my_iterator) is my_iterator)  # True
```

**å…³é”®åŒºåˆ«ï¼š**

| ç‰¹æ€§ | å¯è¿­ä»£å¯¹è±¡ | è¿­ä»£å™¨ |
|-----|----------|-------|
| `__iter__` | âœ… è¿”å›æ–°è¿­ä»£å™¨ | âœ… è¿”å›è‡ªèº« |
| `__next__` | âŒ æ²¡æœ‰ | âœ… æœ‰ |
| å¯å¤šæ¬¡éå† | âœ… æ˜¯ | âŒ å¦ï¼ˆä¸€æ¬¡æ€§ï¼‰ |
| ä¾‹å­ | list, str, dict | iter(list), ç”Ÿæˆå™¨ |

**éªŒè¯ä»£ç ï¼š**
```python
from collections.abc import Iterable, Iterator

# åˆ—è¡¨æ˜¯å¯è¿­ä»£å¯¹è±¡
print(isinstance([1, 2], Iterable))  # True
print(isinstance([1, 2], Iterator))  # False

# ç”Ÿæˆå™¨æ˜¯è¿­ä»£å™¨
gen = (x for x in [1, 2])
print(isinstance(gen, Iterable))  # True
print(isinstance(gen, Iterator))  # True
```

---

### æ ¸å¿ƒæ¦‚å¿µ3ï¼šfor å¾ªç¯çš„æœ¬è´¨ ğŸ”

**for å¾ªç¯æ˜¯è¿­ä»£å™¨åè®®çš„è¯­æ³•ç³–ã€‚**

```python
# è¿™æ®µ for å¾ªç¯
for item in [1, 2, 3]:
    print(item)

# ç­‰ä»·äºè¿™æ®µä»£ç 
iterator = iter([1, 2, 3])  # è°ƒç”¨ __iter__()
while True:
    try:
        item = next(iterator)  # è°ƒç”¨ __next__()
        print(item)
    except StopIteration:
        break
```

**å®Œæ•´æµç¨‹ï¼š**
```
for item in iterable:
    process(item)

â†“ å±•å¼€ä¸º â†“

1. iterator = iter(iterable)  # è°ƒç”¨ iterable.__iter__()
2. while True:
3.     try:
4.         item = next(iterator)  # è°ƒç”¨ iterator.__next__()
5.         process(item)
6.     except StopIteration:
7.         break
```

**åœ¨å‘é‡æ•°æ®åº“ä¸­çš„åº”ç”¨ï¼š**
ç†è§£ for å¾ªç¯æœ¬è´¨ï¼Œå°±èƒ½è‡ªå®šä¹‰ä»»ä½•æ•°æ®æºçš„éå†è¡Œä¸ºï¼š

```python
class DatabaseResultSet:
    """æ•°æ®åº“ç»“æœé›†ï¼šè‡ªå®šä¹‰ for å¾ªç¯è¡Œä¸º"""
    def __init__(self, cursor):
        self.cursor = cursor
    
    def __iter__(self):
        return self
    
    def __next__(self):
        row = self.cursor.fetchone()
        if row is None:
            raise StopIteration
        return row

# ç”¨ for å¾ªç¯éå†æ•°æ®åº“ç»“æœ
for row in DatabaseResultSet(cursor):
    print(row)
```

---

## 4. ã€æœ€å°å¯ç”¨ã€‘

æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½åœ¨80%çš„åœºæ™¯ä¸­ä½¿ç”¨è¿­ä»£å™¨ï¼š

### 4.1 ä½¿ç”¨å†…ç½®çš„ iter() å’Œ next()

```python
# ä»å¯è¿­ä»£å¯¹è±¡è·å–è¿­ä»£å™¨
my_list = [1, 2, 3]
it = iter(my_list)

# æ‰‹åŠ¨è·å–å…ƒç´ 
print(next(it))  # 1
print(next(it))  # 2
print(next(it))  # 3
print(next(it, 'æ²¡äº†'))  # 'æ²¡äº†'ï¼ˆé»˜è®¤å€¼ï¼Œé¿å…å¼‚å¸¸ï¼‰
```

### 4.2 åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¿­ä»£

```python
from collections.abc import Iterable, Iterator

def is_iterable(obj):
    return isinstance(obj, Iterable)

print(is_iterable([1, 2, 3]))     # True
print(is_iterable("hello"))       # True
print(is_iterable(123))           # False
print(is_iterable({'a': 1}))      # True
print(is_iterable(range(10)))     # True
```

### 4.3 å®ç°ç®€å•çš„è¿­ä»£å™¨ç±»

```python
class CountDown:
    """å€’è®¡æ—¶è¿­ä»£å™¨"""
    def __init__(self, start):
        self.current = start
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.current <= 0:
            raise StopIteration
        self.current -= 1
        return self.current + 1

# ä½¿ç”¨
for num in CountDown(5):
    print(num)  # 5 4 3 2 1
```

### 4.4 è®©è‡ªå®šä¹‰ç±»æ”¯æŒ for å¾ªç¯

```python
class VectorBatch:
    """å‘é‡æ‰¹æ¬¡ï¼šæ”¯æŒ for å¾ªç¯"""
    def __init__(self, vectors):
        self.vectors = vectors
    
    def __iter__(self):
        # è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ˆè¿™é‡Œç”¨ç”Ÿæˆå™¨ç®€åŒ–ï¼‰
        for vec in self.vectors:
            yield vec

# ä½¿ç”¨
batch = VectorBatch([[0.1, 0.2], [0.3, 0.4], [0.5, 0.6]])
for vec in batch:
    print(vec)

# å¯ä»¥å¤šæ¬¡éå†ï¼ˆå› ä¸º __iter__ æ¯æ¬¡è¿”å›æ–°ç”Ÿæˆå™¨ï¼‰
for vec in batch:
    print(f"å†æ¬¡: {vec}")
```

### 4.5 ç”Ÿæˆå™¨æ˜¯æœ€ç®€å•çš„è¿­ä»£å™¨

```python
# ç”¨ç”Ÿæˆå™¨å®ç°è¿­ä»£å™¨ï¼Œæ¯”å†™ç±»ç®€å•å¾—å¤š
def countdown(n):
    while n > 0:
        yield n
        n -= 1

for num in countdown(5):
    print(num)  # 5 4 3 2 1
```

**è¿™äº›çŸ¥è¯†è¶³ä»¥ï¼š**
- éå†ä»»ä½•å¯è¿­ä»£å¯¹è±¡
- è‡ªå®šä¹‰ç±»æ”¯æŒ for å¾ªç¯
- ç†è§£ for å¾ªç¯çš„å·¥ä½œåŸç†
- ä¸ºå‘é‡æ•°æ®åº“å®ç°è‡ªå®šä¹‰éå†

---

## 5. ã€1ä¸ªç±»æ¯”ã€‘

### ç±»æ¯”1ï¼šè¿­ä»£å™¨ = JavaScript Iterator ğŸ¨

Python è¿­ä»£å™¨å’Œ JavaScript Iterator æ¦‚å¿µå‡ ä¹ä¸€æ ·ï¼

```javascript
// JavaScript: æ‰‹åŠ¨åˆ›å»ºè¿­ä»£å™¨
const myIterator = {
    data: [1, 2, 3],
    index: 0,
    next() {
        if (this.index < this.data.length) {
            return { value: this.data[this.index++], done: false };
        }
        return { done: true };
    },
    [Symbol.iterator]() {
        return this;
    }
};

for (const item of myIterator) {
    console.log(item);  // 1 2 3
}
```

```python
# Python: ç­‰ä»·å®ç°
class MyIterator:
    def __init__(self):
        self.data = [1, 2, 3]
        self.index = 0
    
    def __next__(self):
        if self.index < len(self.data):
            value = self.data[self.index]
            self.index += 1
            return value
        raise StopIteration
    
    def __iter__(self):
        return self

for item in MyIterator():
    print(item)  # 1 2 3
```

**å¯¹åº”å…³ç³»ï¼š**
| Python | JavaScript |
|--------|-----------|
| `__iter__` | `[Symbol.iterator]` |
| `__next__` | `.next()` |
| `StopIteration` | `{ done: true }` |
| `value` | `{ value: x, done: false }` |

---

### ç±»æ¯”2ï¼šè¿­ä»£å™¨ = for...of å¾ªç¯ ğŸ”

```javascript
// JavaScript: for...of éå†å¯è¿­ä»£å¯¹è±¡
const arr = [1, 2, 3];
for (const item of arr) {
    console.log(item);
}

// ç­‰ä»·äº
const iterator = arr[Symbol.iterator]();
let result = iterator.next();
while (!result.done) {
    console.log(result.value);
    result = iterator.next();
}
```

```python
# Python: for å¾ªç¯éå†å¯è¿­ä»£å¯¹è±¡
arr = [1, 2, 3]
for item in arr:
    print(item)

# ç­‰ä»·äº
iterator = iter(arr)
while True:
    try:
        item = next(iterator)
        print(item)
    except StopIteration:
        break
```

---

### ç±»æ¯”3ï¼šè¿­ä»£å™¨ = æ•°ç»„çš„ .values() ğŸ“‹

```javascript
// JavaScript: æ•°ç»„çš„ .values() è¿”å›è¿­ä»£å™¨
const arr = ['a', 'b', 'c'];
const iterator = arr.values();

console.log(iterator.next().value);  // 'a'
console.log(iterator.next().value);  // 'b'
console.log(iterator.next().value);  // 'c'
console.log(iterator.next().done);   // true
```

```python
# Python: iter() è¿”å›è¿­ä»£å™¨
arr = ['a', 'b', 'c']
iterator = iter(arr)

print(next(iterator))  # 'a'
print(next(iterator))  # 'b'
print(next(iterator))  # 'c'
# next(iterator) -> StopIteration
```

---

### ç±»æ¯”4ï¼šè¿­ä»£å™¨ = React çš„ children éå† ğŸ‘¶

```javascript
// React: React.Children.forEach éå†å­å…ƒç´ 
function Parent({ children }) {
    React.Children.forEach(children, (child, index) => {
        console.log(child, index);
    });
    return <div>{children}</div>;
}
```

```python
# Python: è‡ªå®šä¹‰å¯è¿­ä»£çš„ç»„ä»¶å®¹å™¨
class ComponentContainer:
    def __init__(self, *components):
        self.components = components
    
    def __iter__(self):
        for component in self.components:
            yield component

container = ComponentContainer('Header', 'Body', 'Footer')
for component in container:
    print(component)
```

---

### ç±»æ¯”5ï¼šè¿­ä»£å™¨ = åˆ†é¡µ API çš„ç¿»é¡µ ğŸ“„

```javascript
// å‰ç«¯ï¼šåˆ†é¡µ API çš„æŠ½è±¡
class PageIterator {
    constructor(fetchPage) {
        this.fetchPage = fetchPage;
        this.page = 0;
        this.done = false;
    }
    
    async next() {
        if (this.done) return { done: true };
        const data = await this.fetchPage(this.page++);
        if (data.length === 0) {
            this.done = true;
            return { done: true };
        }
        return { value: data, done: false };
    }
    
    [Symbol.asyncIterator]() {
        return this;
    }
}

// ä½¿ç”¨
for await (const page of new PageIterator(fetchUsers)) {
    renderUsers(page);
}
```

```python
# Python: åˆ†é¡µè¿­ä»£å™¨
class PageIterator:
    def __init__(self, fetch_page):
        self.fetch_page = fetch_page
        self.page = 0
    
    def __iter__(self):
        return self
    
    def __next__(self):
        data = self.fetch_page(self.page)
        if not data:
            raise StopIteration
        self.page += 1
        return data

# ä½¿ç”¨
for page in PageIterator(fetch_vectors):
    process_batch(page)
```

---

### ç±»æ¯”æ€»ç»“è¡¨

| Python è¿­ä»£å™¨æ¦‚å¿µ | å‰ç«¯/JS å¯¹åº”æ¦‚å¿µ |
|-----------------|----------------|
| `__iter__` | `[Symbol.iterator]` |
| `__next__` | `.next()` |
| `StopIteration` | `{ done: true }` |
| `for item in obj` | `for (item of obj)` |
| `iter(obj)` | `obj[Symbol.iterator]()` |
| `next(it)` | `it.next().value` |
| å¯è¿­ä»£å¯¹è±¡ | Iterable |
| è¿­ä»£å™¨ | Iterator |

---

## 6. ã€åç›´è§‰ç‚¹ã€‘

### è¯¯åŒº1ï¼šåˆ—è¡¨å°±æ˜¯è¿­ä»£å™¨ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- åˆ—è¡¨æ˜¯**å¯è¿­ä»£å¯¹è±¡**ï¼Œä¸æ˜¯**è¿­ä»£å™¨**
- åˆ—è¡¨æ²¡æœ‰ `__next__` æ–¹æ³•
- åˆ—è¡¨æ¯æ¬¡ `iter()` è¿”å›æ–°çš„è¿­ä»£å™¨

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
å› ä¸ºåˆ—è¡¨å¯ä»¥ç”¨ for å¾ªç¯éå†ï¼Œæ‰€ä»¥è¯¯ä»¥ä¸ºå®ƒå°±æ˜¯è¿­ä»£å™¨ã€‚

**æ­£ç¡®ç†è§£ï¼š**
```python
my_list = [1, 2, 3]

# åˆ—è¡¨æ²¡æœ‰ __next__
print(hasattr(my_list, '__next__'))  # False

# ä¸èƒ½å¯¹åˆ—è¡¨ç›´æ¥è°ƒç”¨ next()
# next(my_list)  # TypeError!

# å¿…é¡»å…ˆè·å–è¿­ä»£å™¨
iterator = iter(my_list)
print(next(iterator))  # 1

# åˆ—è¡¨å¯ä»¥å¤šæ¬¡éå†ï¼ˆæ¯æ¬¡åˆ›å»ºæ–°è¿­ä»£å™¨ï¼‰
for x in my_list:
    print(x)  # 1 2 3
for x in my_list:
    print(x)  # 1 2 3ï¼ˆå¯ä»¥å†æ¬¡éå†ï¼‰

# è¿­ä»£å™¨åªèƒ½éå†ä¸€æ¬¡
iterator = iter(my_list)
print(list(iterator))  # [1, 2, 3]
print(list(iterator))  # []ï¼ˆå·²è€—å°½ï¼‰
```

---

### è¯¯åŒº2ï¼šè¿­ä»£å™¨å¯ä»¥é‡ç½®/é‡å¤ä½¿ç”¨ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- è¿­ä»£å™¨æ˜¯ä¸€æ¬¡æ€§çš„
- è€—å°½åä¸èƒ½é‡ç½®
- æƒ³å†æ¬¡éå†å¿…é¡»åˆ›å»ºæ–°è¿­ä»£å™¨

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
å› ä¸ºå¾ˆå¤šè¯­è¨€çš„è¿­ä»£å™¨å¯ä»¥ resetï¼Œè€Œä¸”"è¿­ä»£"è¿™ä¸ªè¯å¬èµ·æ¥åƒæ˜¯å¯ä»¥é‡å¤çš„ã€‚

**æ­£ç¡®ç†è§£ï¼š**
```python
# è¿­ä»£å™¨ä¸€æ¬¡æ€§
numbers = iter([1, 2, 3])
print(list(numbers))  # [1, 2, 3]
print(list(numbers))  # []ï¼ˆå·²è€—å°½ï¼ï¼‰

# ç”Ÿæˆå™¨ä¹Ÿæ˜¯ä¸€æ¬¡æ€§
gen = (x for x in [1, 2, 3])
print(list(gen))  # [1, 2, 3]
print(list(gen))  # []ï¼ˆå·²è€—å°½ï¼ï¼‰

# æ­£ç¡®åšæ³•1ï¼šé‡æ–°åˆ›å»ºè¿­ä»£å™¨
numbers = iter([1, 2, 3])
print(list(numbers))  # [1, 2, 3]
numbers = iter([1, 2, 3])  # é‡æ–°åˆ›å»º
print(list(numbers))  # [1, 2, 3]

# æ­£ç¡®åšæ³•2ï¼šä½¿ç”¨å¯è¿­ä»£å¯¹è±¡
my_list = [1, 2, 3]
print(list(my_list))  # [1, 2, 3]
print(list(my_list))  # [1, 2, 3]ï¼ˆå¯é‡å¤ï¼‰
```

---

### è¯¯åŒº3ï¼šå®ç°äº† `__iter__` å°±æ˜¯è¿­ä»£å™¨ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- åªå®ç° `__iter__` æ˜¯**å¯è¿­ä»£å¯¹è±¡**
- å¿…é¡»åŒæ—¶å®ç° `__iter__` å’Œ `__next__` æ‰æ˜¯**è¿­ä»£å™¨**

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
å› ä¸ºä¸¤ä¸ªæ¦‚å¿µåå­—å¾ˆåƒï¼Œè€Œä¸”éƒ½å’Œ"è¿­ä»£"æœ‰å…³ã€‚

**æ­£ç¡®ç†è§£ï¼š**
```python
from collections.abc import Iterable, Iterator

# åªæœ‰ __iter__ çš„ç±»ï¼šå¯è¿­ä»£å¯¹è±¡ï¼Œä¸æ˜¯è¿­ä»£å™¨
class OnlyIter:
    def __iter__(self):
        return iter([1, 2, 3])

obj = OnlyIter()
print(isinstance(obj, Iterable))  # True
print(isinstance(obj, Iterator))  # False

# åŒæ—¶æœ‰ __iter__ å’Œ __next__ï¼šæ˜¯è¿­ä»£å™¨
class BothMethods:
    def __init__(self):
        self.data = [1, 2, 3]
        self.index = 0
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.index >= len(self.data):
            raise StopIteration
        value = self.data[self.index]
        self.index += 1
        return value

obj = BothMethods()
print(isinstance(obj, Iterable))  # True
print(isinstance(obj, Iterator))  # True
```

**è®°å¿†å£è¯€ï¼š**
- å¯è¿­ä»£ = èƒ½ç”Ÿè¿­ä»£å™¨ = æœ‰ `__iter__`
- è¿­ä»£å™¨ = èƒ½å–ä¸‹ä¸€ä¸ª = æœ‰ `__iter__` + `__next__`

---

## 7. ã€å®æˆ˜ä»£ç ã€‘

```python
"""
è¿­ä»£å™¨å®æˆ˜ç¤ºä¾‹ï¼šå‘é‡æ•°æ®åº“æ“ä½œ
å±•ç¤ºè¿­ä»£å™¨åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨
"""

from collections.abc import Iterable, Iterator
import time
import random

# ===== 1. åŸºç¡€ï¼šiter() å’Œ next() =====
print("=== 1. åŸºç¡€ï¼šiter() å’Œ next() ===")

my_list = [10, 20, 30]
iterator = iter(my_list)

print(f"ç±»å‹: {type(iterator)}")
print(f"next: {next(iterator)}")  # 10
print(f"next: {next(iterator)}")  # 20
print(f"next: {next(iterator)}")  # 30
print(f"next with default: {next(iterator, 'æ²¡äº†')}")  # 'æ²¡äº†'

# ===== 2. å¯è¿­ä»£ vs è¿­ä»£å™¨ =====
print("\n=== 2. å¯è¿­ä»£ vs è¿­ä»£å™¨ ===")

my_list = [1, 2, 3]
my_gen = (x for x in [1, 2, 3])

print(f"åˆ—è¡¨æ˜¯å¯è¿­ä»£: {isinstance(my_list, Iterable)}")  # True
print(f"åˆ—è¡¨æ˜¯è¿­ä»£å™¨: {isinstance(my_list, Iterator)}")  # False
print(f"ç”Ÿæˆå™¨æ˜¯å¯è¿­ä»£: {isinstance(my_gen, Iterable)}")  # True
print(f"ç”Ÿæˆå™¨æ˜¯è¿­ä»£å™¨: {isinstance(my_gen, Iterator)}")  # True

# ===== 3. è‡ªå®šä¹‰è¿­ä»£å™¨ç±» =====
print("\n=== 3. è‡ªå®šä¹‰è¿­ä»£å™¨ç±» ===")

class VectorIterator:
    """å‘é‡é›†åˆè¿­ä»£å™¨"""
    def __init__(self, vectors):
        self.vectors = vectors
        self.index = 0
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.index >= len(self.vectors):
            raise StopIteration
        vector = self.vectors[self.index]
        self.index += 1
        return vector

vectors = [[0.1, 0.2], [0.3, 0.4], [0.5, 0.6]]
for vec in VectorIterator(vectors):
    print(f"  å‘é‡: {vec}")

# ===== 4. å¯è¿­ä»£ç±»ï¼ˆæ¯æ¬¡è¿”å›æ–°è¿­ä»£å™¨ï¼‰=====
print("\n=== 4. å¯è¿­ä»£ç±» ===")

class VectorCollection:
    """å‘é‡é›†åˆï¼šå¯å¤šæ¬¡éå†"""
    def __init__(self, vectors):
        self.vectors = list(vectors)
    
    def __iter__(self):
        # æ¯æ¬¡è¿”å›æ–°çš„è¿­ä»£å™¨
        return iter(self.vectors)
    
    def __len__(self):
        return len(self.vectors)

collection = VectorCollection([[1, 2], [3, 4], [5, 6]])

# å¯ä»¥å¤šæ¬¡éå†
print("ç¬¬ä¸€æ¬¡éå†:")
for vec in collection:
    print(f"  {vec}")

print("ç¬¬äºŒæ¬¡éå†:")
for vec in collection:
    print(f"  {vec}")

# ===== 5. åˆ†é¡µè¿­ä»£å™¨ =====
print("\n=== 5. åˆ†é¡µè¿­ä»£å™¨ ===")

class PaginatedIterator:
    """åˆ†é¡µè¿­ä»£å™¨ï¼šæ¨¡æ‹Ÿæ•°æ®åº“åˆ†é¡µæŸ¥è¯¢"""
    def __init__(self, total_items, page_size=3):
        self.total_items = total_items
        self.page_size = page_size
        self.current_index = 0
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.current_index >= self.total_items:
            raise StopIteration
        
        # æ¨¡æ‹Ÿè·å–ä¸€é¡µæ•°æ®
        start = self.current_index
        end = min(start + self.page_size, self.total_items)
        page = list(range(start, end))
        
        self.current_index = end
        return page

print("åˆ†é¡µç»“æœ:")
for page in PaginatedIterator(10, page_size=3):
    print(f"  é¡µ: {page}")

# ===== 6. å¸¦è¿‡æ»¤çš„è¿­ä»£å™¨ =====
print("\n=== 6. å¸¦è¿‡æ»¤çš„è¿­ä»£å™¨ ===")

class FilteredIterator:
    """è¿‡æ»¤è¿­ä»£å™¨ï¼šåªè¿”å›æ»¡è¶³æ¡ä»¶çš„å…ƒç´ """
    def __init__(self, iterable, predicate):
        self.iterator = iter(iterable)
        self.predicate = predicate
    
    def __iter__(self):
        return self
    
    def __next__(self):
        while True:
            item = next(self.iterator)  # å¯èƒ½æŠ› StopIteration
            if self.predicate(item):
                return item

# åªè·å–åˆ†æ•° >= 0.8 çš„ç»“æœ
results = [
    {'id': 1, 'score': 0.95},
    {'id': 2, 'score': 0.72},
    {'id': 3, 'score': 0.88},
    {'id': 4, 'score': 0.65},
    {'id': 5, 'score': 0.91},
]

high_score = FilteredIterator(results, lambda x: x['score'] >= 0.8)
print("é«˜åˆ†ç»“æœ:")
for r in high_score:
    print(f"  ID: {r['id']}, Score: {r['score']}")

# ===== 7. æ˜ å°„è¿­ä»£å™¨ =====
print("\n=== 7. æ˜ å°„è¿­ä»£å™¨ ===")

class MapIterator:
    """æ˜ å°„è¿­ä»£å™¨ï¼šå¯¹æ¯ä¸ªå…ƒç´ åº”ç”¨å‡½æ•°"""
    def __init__(self, iterable, func):
        self.iterator = iter(iterable)
        self.func = func
    
    def __iter__(self):
        return self
    
    def __next__(self):
        item = next(self.iterator)
        return self.func(item)

vectors = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]

# è®¡ç®—æ¯ä¸ªå‘é‡çš„èŒƒæ•°
def vector_norm(v):
    return sum(x**2 for x in v) ** 0.5

norms = MapIterator(vectors, vector_norm)
print("å‘é‡èŒƒæ•°:")
for norm in norms:
    print(f"  {norm:.2f}")

# ===== 8. é“¾å¼è¿­ä»£å™¨ =====
print("\n=== 8. é“¾å¼è¿­ä»£å™¨ ===")

class ChainIterator:
    """é“¾å¼è¿­ä»£å™¨ï¼šè¿æ¥å¤šä¸ªå¯è¿­ä»£å¯¹è±¡"""
    def __init__(self, *iterables):
        self.iterables = iter(iterables)
        self.current = iter(next(self.iterables, []))
    
    def __iter__(self):
        return self
    
    def __next__(self):
        while True:
            try:
                return next(self.current)
            except StopIteration:
                self.current = iter(next(self.iterables))

# è¿æ¥å¤šä¸ªå‘é‡æ¥æº
source1 = [1, 2, 3]
source2 = [4, 5, 6]
source3 = [7, 8, 9]

chain = ChainIterator(source1, source2, source3)
print(f"é“¾å¼ç»“æœ: {list(chain)}")

# ===== 9. å‘é‡æ•°æ®åº“æ¸¸æ ‡æ¨¡æ‹Ÿ =====
print("\n=== 9. å‘é‡æ•°æ®åº“æ¸¸æ ‡æ¨¡æ‹Ÿ ===")

class VectorDBCursor:
    """æ¨¡æ‹Ÿå‘é‡æ•°æ®åº“æ¸¸æ ‡"""
    def __init__(self, total_vectors, batch_size=5):
        self.total = total_vectors
        self.batch_size = batch_size
        self.offset = 0
        self.buffer = []
    
    def _fetch_batch(self):
        """æ¨¡æ‹Ÿä»æ•°æ®åº“è·å–ä¸€æ‰¹æ•°æ®"""
        if self.offset >= self.total:
            return []
        
        # æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
        time.sleep(0.01)
        
        end = min(self.offset + self.batch_size, self.total)
        batch = [
            {'id': i, 'vector': [random.random() for _ in range(4)]}
            for i in range(self.offset, end)
        ]
        self.offset = end
        return batch
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if not self.buffer:
            self.buffer = self._fetch_batch()
        
        if not self.buffer:
            raise StopIteration
        
        return self.buffer.pop(0)

print("æ•°æ®åº“æ¸¸æ ‡éå†:")
cursor = VectorDBCursor(12, batch_size=5)
for i, record in enumerate(cursor):
    print(f"  è®°å½• {record['id']}: vector dim = {len(record['vector'])}")
    if i >= 4:  # åªæ‰“å°å‰5ä¸ª
        print("  ...")
        break

# ===== 10. for å¾ªç¯çš„æœ¬è´¨æ¼”ç¤º =====
print("\n=== 10. for å¾ªç¯çš„æœ¬è´¨ ===")

print("æ™®é€š for å¾ªç¯:")
for x in [1, 2, 3]:
    print(f"  {x}")

print("\nç­‰ä»·çš„æ‰‹åŠ¨å®ç°:")
iterator = iter([1, 2, 3])
while True:
    try:
        x = next(iterator)
        print(f"  {x}")
    except StopIteration:
        break

# ===== 11. itertools å·¥å…· =====
print("\n=== 11. itertools å·¥å…· ===")

import itertools

# islice: åˆ‡ç‰‡è¿­ä»£å™¨
print("islice (å–å‰3ä¸ª):")
for x in itertools.islice(range(100), 3):
    print(f"  {x}")

# chain: é“¾æ¥è¿­ä»£å™¨
print("chain (è¿æ¥å¤šä¸ª):")
for x in itertools.chain([1, 2], [3, 4], [5, 6]):
    print(f"  {x}", end=" ")
print()

# cycle: æ— é™å¾ªç¯ï¼ˆå°å¿ƒä½¿ç”¨ï¼‰
print("cycle (å¾ªç¯3æ¬¡):")
cycler = itertools.cycle(['A', 'B'])
for i, x in enumerate(cycler):
    if i >= 6:
        break
    print(f"  {x}", end=" ")
print()

# ç»„åˆä½¿ç”¨ï¼šæ‰¹é‡å¤„ç†
def batched(iterable, n):
    """å°†è¿­ä»£å™¨åˆ†æ‰¹ï¼ˆPython 3.12+ æœ‰å†…ç½® itertools.batchedï¼‰"""
    it = iter(iterable)
    while batch := list(itertools.islice(it, n)):
        yield batch

print("åˆ†æ‰¹å¤„ç†:")
for batch in batched(range(10), 3):
    print(f"  æ‰¹æ¬¡: {batch}")
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**
```
=== 1. åŸºç¡€ï¼šiter() å’Œ next() ===
ç±»å‹: <class 'list_iterator'>
next: 10
next: 20
next: 30
next with default: æ²¡äº†

=== 2. å¯è¿­ä»£ vs è¿­ä»£å™¨ ===
åˆ—è¡¨æ˜¯å¯è¿­ä»£: True
åˆ—è¡¨æ˜¯è¿­ä»£å™¨: False
ç”Ÿæˆå™¨æ˜¯å¯è¿­ä»£: True
ç”Ÿæˆå™¨æ˜¯è¿­ä»£å™¨: True

=== 3. è‡ªå®šä¹‰è¿­ä»£å™¨ç±» ===
  å‘é‡: [0.1, 0.2]
  å‘é‡: [0.3, 0.4]
  å‘é‡: [0.5, 0.6]

=== 4. å¯è¿­ä»£ç±» ===
ç¬¬ä¸€æ¬¡éå†:
  [1, 2]
  [3, 4]
  [5, 6]
ç¬¬äºŒæ¬¡éå†:
  [1, 2]
  [3, 4]
  [5, 6]

=== 5. åˆ†é¡µè¿­ä»£å™¨ ===
åˆ†é¡µç»“æœ:
  é¡µ: [0, 1, 2]
  é¡µ: [3, 4, 5]
  é¡µ: [6, 7, 8]
  é¡µ: [9]

=== 6. å¸¦è¿‡æ»¤çš„è¿­ä»£å™¨ ===
é«˜åˆ†ç»“æœ:
  ID: 1, Score: 0.95
  ID: 3, Score: 0.88
  ID: 5, Score: 0.91

...
```

---

## 8. ã€é¢è¯•å¿…é—®ã€‘

### é—®é¢˜1ï¼š"è¿­ä»£å™¨å’Œå¯è¿­ä»£å¯¹è±¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"è¿­ä»£å™¨å¯ä»¥ç”¨ next() å–å€¼ï¼Œå¯è¿­ä»£å¯¹è±¡å¯ä»¥ç”¨ for å¾ªç¯ã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **åŒºåˆ«æœ‰ä¸‰ä¸ªå±‚é¢ï¼š**
>
> 1. **åè®®å±‚é¢**ï¼š
>    - å¯è¿­ä»£å¯¹è±¡ï¼šå®ç° `__iter__`ï¼Œè¿”å›ä¸€ä¸ªè¿­ä»£å™¨
>    - è¿­ä»£å™¨ï¼šå®ç° `__iter__`ï¼ˆè¿”å›è‡ªèº«ï¼‰+ `__next__`ï¼ˆè¿”å›ä¸‹ä¸€ä¸ªå€¼ï¼‰
>
> 2. **ä½¿ç”¨å±‚é¢**ï¼š
>    - å¯è¿­ä»£å¯¹è±¡å¯ä»¥å¤šæ¬¡éå†ï¼ˆæ¯æ¬¡åˆ›å»ºæ–°è¿­ä»£å™¨ï¼‰
>    - è¿­ä»£å™¨åªèƒ½éå†ä¸€æ¬¡ï¼ˆä¸€æ¬¡æ€§çš„ï¼‰
>
> 3. **å…¸å‹ä¾‹å­**ï¼š
>    - å¯è¿­ä»£å¯¹è±¡ï¼šlist, dict, str, range
>    - è¿­ä»£å™¨ï¼šiter(list), ç”Ÿæˆå™¨, æ–‡ä»¶å¯¹è±¡
>
> **ä»£ç éªŒè¯ï¼š**
> ```python
> lst = [1, 2, 3]
> print(list(lst), list(lst))  # [1,2,3] [1,2,3] å¯å¤šæ¬¡
>
> it = iter(lst)
> print(list(it), list(it))  # [1,2,3] [] ä¸€æ¬¡æ€§
> ```
>
> **å®é™…åº”ç”¨**ï¼šåœ¨å‘é‡æ•°æ®åº“ä¸­ï¼Œé›†åˆç±»é€šå¸¸æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼ˆå¯å¤šæ¬¡éå†ï¼‰ï¼Œè€ŒæŸ¥è¯¢æ¸¸æ ‡æ˜¯è¿­ä»£å™¨ï¼ˆéå†ä¸€æ¬¡å°±è€—å°½ï¼‰ã€‚

---

### é—®é¢˜2ï¼š"for å¾ªç¯æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"for å¾ªç¯éå†åˆ—è¡¨é‡Œçš„æ¯ä¸ªå…ƒç´ ã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **for å¾ªç¯æ˜¯è¿­ä»£å™¨åè®®çš„è¯­æ³•ç³–ï¼Œåˆ†ä¸‰æ­¥ï¼š**
>
> 1. **è·å–è¿­ä»£å™¨**ï¼šè°ƒç”¨ `iter(obj)`ï¼Œå³ `obj.__iter__()`
> 2. **å¾ªç¯è°ƒç”¨**ï¼šä¸æ–­è°ƒç”¨ `next(iterator)`ï¼Œå³ `iterator.__next__()`
> 3. **æ•è·ç»“æŸ**ï¼šé‡åˆ° `StopIteration` å¼‚å¸¸ï¼Œå¾ªç¯ç»“æŸ
>
> **ç­‰ä»·ä»£ç ï¼š**
> ```python
> # for item in iterable: body
> #     ç­‰ä»·äº
> iterator = iter(iterable)
> while True:
>     try:
>         item = next(iterator)
>         body
>     except StopIteration:
>         break
> ```
>
> **è¿™æ„å‘³ç€**ï¼šä»»ä½•å®ç°äº†è¿­ä»£å™¨åè®®çš„å¯¹è±¡éƒ½èƒ½ç”¨ for å¾ªç¯ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ç±»ã€ç”Ÿæˆå™¨ã€æ•°æ®åº“æ¸¸æ ‡ç­‰ã€‚
>
> **å®é™…åº”ç”¨**ï¼šç†è§£è¿™ä¸ªåŸç†åï¼Œæˆ‘å¯ä»¥ä¸ºå‘é‡æ•°æ®åº“çš„æŸ¥è¯¢ç»“æœå®ç°è‡ªå®šä¹‰è¿­ä»£è¡Œä¸ºï¼Œæ¯”å¦‚è‡ªåŠ¨åˆ†é¡µã€å»¶è¿ŸåŠ è½½ç­‰ã€‚

---

## 9. ã€åŒ–éª¨ç»µæŒã€‘

### å¡ç‰‡1ï¼šä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ ğŸ¯

**ä¸€å¥è¯ï¼š** è¿­ä»£å™¨æ˜¯èƒ½ä¸€ä¸ªä¸€ä¸ªå–å‡ºå…ƒç´ çš„å¯¹è±¡ã€‚

**åè®®ï¼š**
```python
class Iterator:
    def __iter__(self):
        return self
    
    def __next__(self):
        # è¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ 
        # æ²¡æœ‰äº†æŠ› StopIteration
```

---

### å¡ç‰‡2ï¼šiter() å’Œ next() ğŸ“¥

**ä¸€å¥è¯ï¼š** iter() è·å–è¿­ä»£å™¨ï¼Œnext() è·å–ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚

**ä»£ç ï¼š**
```python
lst = [1, 2, 3]
it = iter(lst)       # è·å–è¿­ä»£å™¨
print(next(it))      # 1
print(next(it))      # 2
print(next(it, 'å®Œ'))  # 3 æˆ–é»˜è®¤å€¼
```

---

### å¡ç‰‡3ï¼šå¯è¿­ä»£ vs è¿­ä»£å™¨ âš–ï¸

**ä¸€å¥è¯ï¼š** å¯è¿­ä»£èƒ½ç”Ÿè¿­ä»£å™¨ï¼Œè¿­ä»£å™¨èƒ½å–ä¸‹ä¸€ä¸ªã€‚

**åŒºåˆ«ï¼š**
| | å¯è¿­ä»£ | è¿­ä»£å™¨ |
|-|-------|-------|
| `__iter__` | âœ… | âœ… |
| `__next__` | âŒ | âœ… |
| å¤šæ¬¡éå† | âœ… | âŒ |

---

### å¡ç‰‡4ï¼šfor å¾ªç¯æœ¬è´¨ ğŸ”

**ä¸€å¥è¯ï¼š** for å¾ªç¯ = iter() + while + next() + StopIterationã€‚

**å±•å¼€ï¼š**
```python
for x in obj:
    print(x)

# ç­‰äº
it = iter(obj)
while True:
    try:
        x = next(it)
        print(x)
    except StopIteration:
        break
```

---

### å¡ç‰‡5ï¼šè¿­ä»£å™¨æ˜¯ä¸€æ¬¡æ€§çš„ âš ï¸

**ä¸€å¥è¯ï¼š** è¿­ä»£å™¨è€—å°½åä¸èƒ½é‡ç½®ã€‚

**ä»£ç ï¼š**
```python
it = iter([1, 2, 3])
print(list(it))  # [1, 2, 3]
print(list(it))  # []ï¼ˆç©ºäº†ï¼ï¼‰

# æƒ³å†ç”¨ï¼Ÿé‡æ–°åˆ›å»º
it = iter([1, 2, 3])
```

---

### å¡ç‰‡6ï¼šè‡ªå®šä¹‰è¿­ä»£å™¨ ğŸ› ï¸

**ä¸€å¥è¯ï¼š** å®ç° `__iter__` å’Œ `__next__` ä¸¤ä¸ªæ–¹æ³•ã€‚

**æ¨¡æ¿ï¼š**
```python
class MyIterator:
    def __init__(self, data):
        self.data = data
        self.index = 0
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if self.index >= len(self.data):
            raise StopIteration
        val = self.data[self.index]
        self.index += 1
        return val
```

---

### å¡ç‰‡7ï¼šè®©ç±»å¯éå† ğŸ

**ä¸€å¥è¯ï¼š** å®ç° `__iter__` è¿”å›è¿­ä»£å™¨ï¼ˆå¯ç”¨ç”Ÿæˆå™¨ç®€åŒ–ï¼‰ã€‚

**ä»£ç ï¼š**
```python
class MyCollection:
    def __init__(self, items):
        self.items = items
    
    def __iter__(self):
        for item in self.items:
            yield item  # ç”¨ç”Ÿæˆå™¨æœ€ç®€å•

for x in MyCollection([1, 2, 3]):
    print(x)
```

---

### å¡ç‰‡8ï¼šç”Ÿæˆå™¨å°±æ˜¯è¿­ä»£å™¨ ğŸ”—

**ä¸€å¥è¯ï¼š** ç”Ÿæˆå™¨è‡ªåŠ¨å®ç°äº†è¿­ä»£å™¨åè®®ã€‚

**éªŒè¯ï¼š**
```python
from collections.abc import Iterator

gen = (x for x in [1, 2, 3])
print(isinstance(gen, Iterator))  # True

# ç”Ÿæˆå™¨æœ‰ __iter__ å’Œ __next__
print(hasattr(gen, '__iter__'))  # True
print(hasattr(gen, '__next__'))  # True
```

---

### å¡ç‰‡9ï¼šitertools å·¥å…·ç®± ğŸ§°

**ä¸€å¥è¯ï¼š** æ ‡å‡†åº“ itertools æä¾›å¼ºå¤§çš„è¿­ä»£å™¨å·¥å…·ã€‚

**å¸¸ç”¨ï¼š**
```python
import itertools

# å–å‰ N ä¸ª
itertools.islice(iterator, n)

# é“¾æ¥å¤šä¸ª
itertools.chain(iter1, iter2)

# æ— é™è®¡æ•°
itertools.count(start=0)

# é‡å¤å…ƒç´ 
itertools.repeat(value, times)
```

---

### å¡ç‰‡10ï¼šå‘é‡æ•°æ®åº“åº”ç”¨ ğŸ—„ï¸

**ä¸€å¥è¯ï¼š** ç”¨è¿­ä»£å™¨å®ç°å†…å­˜å‹å¥½çš„å¤§æ•°æ®éå†ã€‚

**æ¨¡å¼ï¼š**
```python
class DBCursor:
    def __init__(self, query, batch=100):
        self.query = query
        self.batch = batch
        self.offset = 0
        self.buffer = []
    
    def __iter__(self):
        return self
    
    def __next__(self):
        if not self.buffer:
            self.buffer = fetch(self.query, 
                               self.batch, self.offset)
            self.offset += self.batch
        if not self.buffer:
            raise StopIteration
        return self.buffer.pop(0)
```

---

## 10. ã€ä¸€å¥è¯æ€»ç»“ã€‘

**è¿­ä»£å™¨æ˜¯å®ç°äº† `__iter__` å’Œ `__next__` æ–¹æ³•çš„å¯¹è±¡ï¼Œæä¾›ç»Ÿä¸€çš„"é€ä¸ªè®¿é—®"æ¥å£ï¼Œæ˜¯ for å¾ªç¯çš„åº•å±‚æœºåˆ¶ï¼Œåœ¨å‘é‡æ•°æ®åº“å¼€å‘ä¸­ç”¨äºå®ç°å†…å­˜å‹å¥½çš„å¤§æ•°æ®éå†å’Œåˆ†é¡µæŸ¥è¯¢ã€‚**

---

## ğŸ“š å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£è¿­ä»£å™¨åè®®ï¼ˆ`__iter__` + `__next__`ï¼‰
- [ ] åŒºåˆ†å¯è¿­ä»£å¯¹è±¡å’Œè¿­ä»£å™¨
- [ ] èƒ½ç”¨ iter() å’Œ next() æ‰‹åŠ¨è¿­ä»£
- [ ] ç†è§£ for å¾ªç¯çš„å·¥ä½œåŸç†
- [ ] çŸ¥é“è¿­ä»£å™¨æ˜¯ä¸€æ¬¡æ€§çš„
- [ ] èƒ½å®ç°è‡ªå®šä¹‰è¿­ä»£å™¨ç±»
- [ ] èƒ½è®©è‡ªå®šä¹‰ç±»æ”¯æŒ for å¾ªç¯
- [ ] äº†è§£ itertools å¸¸ç”¨å·¥å…·

## ğŸ”— ä¸‹ä¸€æ­¥å­¦ä¹ 

å­¦å®Œè¿­ä»£å™¨åï¼Œå»ºè®®å­¦ä¹ ï¼š
1. **å¹¶å‘æ¦‚å¿µ** - åŒæ­¥/å¼‚æ­¥åŒºåˆ«
2. **async/await** - å¼‚æ­¥è¿­ä»£å™¨
3. **asyncio** - å¼‚æ­¥ç¼–ç¨‹æ¡†æ¶
