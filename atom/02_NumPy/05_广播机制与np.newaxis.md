# å¹¿æ’­æœºåˆ¶ä¸np.newaxis

> å­¦ä¹ ç›®æ ‡ï¼šæŒæ¡np.newaxisçš„ä½¿ç”¨æ–¹æ³•ï¼Œç†è§£ç»´åº¦æ‰©å±•åœ¨å¹¿æ’­ä¸­çš„ä½œç”¨ï¼Œèƒ½å¤Ÿé«˜æ•ˆå®ç°æ‰¹é‡å‘é‡è¿ç®—

---

## 1. ã€30å­—æ ¸å¿ƒã€‘

**np.newaxisæ˜¯åœ¨æŒ‡å®šä½ç½®æ’å…¥æ–°ç»´åº¦çš„å·¥å…·ï¼Œé…åˆå¹¿æ’­æœºåˆ¶å®ç°é«˜æ•ˆçš„æ‰¹é‡å‘é‡è¿ç®—ï¼Œæ˜¯å‘é‡æ•°æ®åº“æ‰¹é‡è®¡ç®—çš„æ ¸å¿ƒæŠ€å·§ã€‚**

---

## 2. ã€ç¬¬ä¸€æ€§åŸç†ã€‘

### ä»€ä¹ˆæ˜¯ç¬¬ä¸€æ€§åŸç†ï¼Ÿ

**ç¬¬ä¸€æ€§åŸç†**ï¼šå›åˆ°äº‹ç‰©æœ€åŸºæœ¬çš„çœŸç†ï¼Œä»æºå¤´æ€è€ƒé—®é¢˜

### np.newaxisçš„ç¬¬ä¸€æ€§åŸç† ğŸ¯

#### 1. æœ€åŸºç¡€çš„å®šä¹‰

**np.newaxis = åœ¨æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªé•¿åº¦ä¸º1çš„æ–°ç»´åº¦**

```python
import numpy as np

arr = np.array([1, 2, 3])  # shape: (3,)

# åœ¨å‰é¢æ’å…¥ç»´åº¦
arr[np.newaxis, :]  # shape: (1, 3) â†’ è¡Œå‘é‡

# åœ¨åé¢æ’å…¥ç»´åº¦
arr[:, np.newaxis]  # shape: (3, 1) â†’ åˆ—å‘é‡
```

ä»…æ­¤è€Œå·²ï¼**np.newaxis = None**ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ã€‚

---

#### 2. ä¸ºä»€ä¹ˆéœ€è¦np.newaxisï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•è®©ä¸åŒå½¢çŠ¶çš„æ•°ç»„èƒ½å¤Ÿè¿ç®—ï¼Ÿ**

**æ€è€ƒé“¾ï¼š**
```
1. NumPyçš„å¹¿æ’­éœ€è¦å½¢çŠ¶å…¼å®¹
   â†“ é—®é¢˜ï¼šå¾ˆå¤šæƒ…å†µä¸‹å½¢çŠ¶ä¸ç›´æ¥å…¼å®¹
   
2. ä¾‹å¦‚ï¼š(1000,) å’Œ (1000, 768) æ— æ³•ç›´æ¥å¹¿æ’­
   â†“ å¹¿æ’­è§„åˆ™ï¼šä»å³å¾€å·¦å¯¹é½ï¼Œç»´åº¦è¦ä¹ˆç›¸ç­‰ï¼Œè¦ä¹ˆä¸º1
   
3. (1000,) å¯¹é½ (1000, 768)ï¼š
   â†’ (1000,) è¢«è§†ä¸º (1, 1000)? è¿˜æ˜¯ (1000, 1)?
   â†“ NumPyé»˜è®¤ä»å³å¯¹é½ï¼Œä½†è¿™å¯èƒ½ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„
   
4. è§£å†³ï¼šæ˜¾å¼æ’å…¥ç»´åº¦ï¼Œæ§åˆ¶å¯¹é½æ–¹å¼
   â†“ arr[:, np.newaxis] â†’ (1000, 1)
   â†“ arr[np.newaxis, :] â†’ (1, 1000)
   
5. è¿™å°±æ˜¯np.newaxisçš„æœ¬è´¨ï¼
```

---

#### 3. np.newaxisçš„ä¸‰å±‚ä»·å€¼

##### ä»·å€¼1ï¼šæ§åˆ¶å¹¿æ’­æ–¹å‘

**ä¸åŒçš„ç»´åº¦æ’å…¥ä½ç½®ï¼Œå¯¼è‡´ä¸åŒçš„å¹¿æ’­ç»“æœ**

```python
import numpy as np

matrix = np.ones((3, 4))  # (3, 4)
row = np.array([1, 2, 3, 4])  # (4,)
col = np.array([10, 20, 30])  # (3,)

# rowå¹¿æ’­ï¼šæ¯è¡ŒåŠ ä¸Š[1,2,3,4]
result1 = matrix + row  # (3,4) + (4,) â†’ è‡ªåŠ¨å¯¹é½
print(result1)
# [[2, 3, 4, 5],
#  [2, 3, 4, 5],
#  [2, 3, 4, 5]]

# colå¹¿æ’­ï¼šæ¯åˆ—åŠ ä¸Š[10,20,30]
# éœ€è¦æ‰‹åŠ¨è°ƒæ•´å½¢çŠ¶ï¼
col_2d = col[:, np.newaxis]  # (3, 1)
result2 = matrix + col_2d  # (3,4) + (3,1) â†’ å¹¿æ’­
print(result2)
# [[11, 11, 11, 11],
#  [21, 21, 21, 21],
#  [31, 31, 31, 31]]
```

##### ä»·å€¼2ï¼šå®ç°å¤–ç§¯è¿ç®—

**åˆ©ç”¨å¹¿æ’­è®¡ç®—æ‰€æœ‰æˆå¯¹ç»„åˆ**

```python
a = np.array([1, 2, 3])  # (3,)
b = np.array([10, 20, 30, 40])  # (4,)

# å¤–ç§¯ï¼šæ¯å¯¹(a[i], b[j])ç›¸ä¹˜
a_col = a[:, np.newaxis]  # (3, 1)
b_row = b[np.newaxis, :]  # (1, 4)

outer = a_col * b_row  # (3, 1) * (1, 4) â†’ (3, 4)
print(outer)
# [[10, 20, 30, 40],
#  [20, 40, 60, 80],
#  [30, 60, 90, 120]]
```

##### ä»·å€¼3ï¼šæ‰¹é‡è·ç¦»/ç›¸ä¼¼åº¦è®¡ç®—

**å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒæ“ä½œ**

```python
# è®¡ç®—æ‰€æœ‰æˆå¯¹è·ç¦»
points = np.array([[1, 2], [3, 4], [5, 6]])  # (3, 2)

# æ‰©å±•ç»´åº¦å®ç°å¹¿æ’­
p1 = points[:, np.newaxis, :]  # (3, 1, 2)
p2 = points[np.newaxis, :, :]  # (1, 3, 2)

# å¹¿æ’­ç›¸å‡ï¼šæ¯å¯¹ç‚¹çš„å·®
diff = p1 - p2  # (3, 3, 2)

# è®¡ç®—è·ç¦»
distances = np.sqrt((diff ** 2).sum(axis=2))  # (3, 3)
print(distances)
```

---

#### 4. ä»ç¬¬ä¸€æ€§åŸç†æ¨å¯¼å¹¿æ’­è§„åˆ™

**å¹¿æ’­è§„åˆ™ï¼š**
1. ä»å³å¾€å·¦å¯¹é½ç»´åº¦
2. æ¯ä¸ªç»´åº¦è¦ä¹ˆç›¸ç­‰ï¼Œè¦ä¹ˆå…¶ä¸­ä¸€ä¸ªæ˜¯1
3. ç¼ºå¤±çš„ç»´åº¦è§†ä¸º1

**np.newaxiså¦‚ä½•å¸®åŠ©æ»¡è¶³è§„åˆ™ï¼š**

```
åŸå§‹å½¢çŠ¶ï¼š
arr1: (1000,)
arr2: (1000, 768)

ç›´æ¥å¹¿æ’­ï¼š
arr1: (    1000)  â† ä»å³å¯¹é½
arr2: (1000, 768)
       â†“     â†“
       ?    1000 vs 768 â†’ ä¸åŒ¹é…ï¼âŒ

ä½¿ç”¨np.newaxisï¼š
arr1[:, np.newaxis]: (1000, 1)
arr2:               (1000, 768)
                      â†“     â†“
                     1000  1 vs 768 â†’ 1å¯æ‰©å±• âœ…
```

---

#### 5. np.newaxis vs reshape

**ä¸¤è€…éƒ½èƒ½æ”¹å˜å½¢çŠ¶ï¼Œä½†æœ‰åŒºåˆ«ï¼š**

| ç‰¹æ€§ | np.newaxis | reshape |
|-----|-----------|---------|
| è¯­æ³• | `arr[:, np.newaxis]` | `arr.reshape(-1, 1)` |
| è¿”å› | è§†å›¾ï¼ˆä¸å¤åˆ¶ï¼‰ | é€šå¸¸æ˜¯è§†å›¾ |
| çµæ´»æ€§ | åªèƒ½æ’å…¥ç»´åº¦ | å¯ä»»æ„é‡å¡‘ |
| å¯è¯»æ€§ | æ›´ç›´è§‚ | æ›´é€šç”¨ |
| å¸¸ç”¨åœºæ™¯ | å¹¿æ’­å¯¹é½ | ç»´åº¦é‡ç»„ |

```python
arr = np.array([1, 2, 3])  # (3,)

# np.newaxisæ–¹å¼
arr_new = arr[:, np.newaxis]  # (3, 1)

# reshapeæ–¹å¼
arr_reshape = arr.reshape(-1, 1)  # (3, 1)

# ç»“æœç›¸åŒ
np.array_equal(arr_new, arr_reshape)  # True

# æ¨èï¼šç”¨np.newaxisï¼Œæ›´æ¸…æ™°è¡¨è¾¾æ„å›¾
```

---

#### 6. ä¸€å¥è¯æ€»ç»“ç¬¬ä¸€æ€§åŸç†

**np.newaxisé€šè¿‡åœ¨æŒ‡å®šä½ç½®æ’å…¥é•¿åº¦ä¸º1çš„ç»´åº¦ï¼Œä½¿ä¸åŒå½¢çŠ¶çš„æ•°ç»„æ»¡è¶³å¹¿æ’­è§„åˆ™ï¼Œæ˜¯å®ç°æ‰¹é‡å‘é‡è¿ç®—çš„å…³é”®å·¥å…·ã€‚**

---

## 3. ã€3ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‘

### æ ¸å¿ƒæ¦‚å¿µ1ï¼šnp.newaxisçš„æœ¬è´¨ ğŸ”§

**ä¸€å¥è¯å®šä¹‰ï¼š** np.newaxisæ˜¯Noneçš„åˆ«åï¼Œç”¨äºåœ¨ç´¢å¼•æ—¶æ’å…¥æ–°ç»´åº¦

**åŸºæœ¬ç”¨æ³•ï¼š**
```python
import numpy as np

arr = np.array([1, 2, 3, 4, 5])  # shape: (5,)

# æ–¹å¼1ï¼šnp.newaxis
arr_row = arr[np.newaxis, :]  # (1, 5) è¡Œå‘é‡
arr_col = arr[:, np.newaxis]  # (5, 1) åˆ—å‘é‡

# æ–¹å¼2ï¼šNoneï¼ˆå®Œå…¨ç­‰ä»·ï¼‰
arr_row = arr[None, :]  # (1, 5)
arr_col = arr[:, None]  # (5, 1)

print(f"åŸæ•°ç»„: {arr.shape}")
print(f"è¡Œå‘é‡: {arr_row.shape}")
print(f"åˆ—å‘é‡: {arr_col.shape}")
```

**å¤šæ¬¡æ’å…¥ï¼š**
```python
arr = np.array([1, 2, 3])  # (3,)

# æ’å…¥å¤šä¸ªç»´åº¦
arr_3d = arr[np.newaxis, :, np.newaxis]  # (1, 3, 1)
arr_4d = arr[np.newaxis, np.newaxis, :, np.newaxis]  # (1, 1, 3, 1)

print(f"3Då½¢çŠ¶: {arr_3d.shape}")
print(f"4Då½¢çŠ¶: {arr_4d.shape}")
```

**å†…å­˜ç‰¹æ€§ï¼š**
```python
arr = np.array([1, 2, 3])
arr_expanded = arr[:, np.newaxis]

# å…±äº«å†…å­˜ï¼ˆæ˜¯è§†å›¾ï¼Œä¸æ˜¯å¤åˆ¶ï¼‰
print(f"å…±äº«å†…å­˜: {np.shares_memory(arr, arr_expanded)}")  # True

# ä¿®æ”¹åŸæ•°ç»„ä¼šå½±å“æ‰©å±•åçš„æ•°ç»„
arr[0] = 999
print(arr_expanded)  # [[999], [2], [3]]
```

**åœ¨å‘é‡æ•°æ®åº“ä¸­çš„åº”ç”¨ï¼š**
```python
# æ‰¹é‡æŸ¥è¯¢å‘é‡
queries = np.random.rand(5, 768)  # 5ä¸ªæŸ¥è¯¢ï¼Œ768ç»´

# æ–‡æ¡£å‘é‡
docs = np.random.rand(1000, 768)  # 1000ä¸ªæ–‡æ¡£ï¼Œ768ç»´

# æ‰©å±•ç»´åº¦å‡†å¤‡å¹¿æ’­
queries_expanded = queries[:, np.newaxis, :]  # (5, 1, 768)
docs_expanded = docs[np.newaxis, :, :]  # (1, 1000, 768)

# ç°åœ¨å¯ä»¥è®¡ç®—æ‰€æœ‰æˆå¯¹ç›¸ä¼¼åº¦
# queries_expanded * docs_expanded â†’ (5, 1000, 768)
```

---

### æ ¸å¿ƒæ¦‚å¿µ2ï¼šè¡Œå‘é‡ä¸åˆ—å‘é‡ ğŸ“

**ä¸€ç»´æ•°ç»„çš„ä¸¤ç§æ‰©å±•æ–¹å‘ï¼š**

```python
arr = np.array([1, 2, 3])  # (3,) ä¸€ç»´æ•°ç»„

# è¡Œå‘é‡ï¼š(1, 3)
row = arr[np.newaxis, :]  # æˆ– arr[None, :]
print(f"è¡Œå‘é‡:\n{row}")
# [[1 2 3]]

# åˆ—å‘é‡ï¼š(3, 1)
col = arr[:, np.newaxis]  # æˆ– arr[:, None]
print(f"åˆ—å‘é‡:\n{col}")
# [[1]
#  [2]
#  [3]]
```

**å¯è§†åŒ–ç†è§£ï¼š**
```
åŸæ•°ç»„ arr = [1, 2, 3]  å½¢çŠ¶: (3,)

è¡Œå‘é‡ arr[np.newaxis, :]ï¼š
     åˆ—0  åˆ—1  åˆ—2
è¡Œ0 [ 1    2    3 ]    å½¢çŠ¶: (1, 3)

åˆ—å‘é‡ arr[:, np.newaxis]ï¼š
     åˆ—0
è¡Œ0 [ 1 ]
è¡Œ1 [ 2 ]    å½¢çŠ¶: (3, 1)
è¡Œ2 [ 3 ]
```

**å¹¿æ’­ä¸­çš„ä½œç”¨ï¼š**
```python
matrix = np.ones((3, 4))  # (3, 4)

# è¡Œæ–¹å‘å¹¿æ’­ï¼ˆæ¯è¡ŒåŠ ä¸Šç›¸åŒå€¼ï¼‰
row_vec = np.array([1, 2, 3, 4])  # (4,)
result_row = matrix + row_vec  # (3, 4) + (4,) â†’ (3, 4)
# æ¯ä¸€è¡Œéƒ½åŠ  [1, 2, 3, 4]

# åˆ—æ–¹å‘å¹¿æ’­ï¼ˆæ¯åˆ—åŠ ä¸Šç›¸åŒå€¼ï¼‰
col_vec = np.array([10, 20, 30])  # (3,)
col_2d = col_vec[:, np.newaxis]  # (3, 1)
result_col = matrix + col_2d  # (3, 4) + (3, 1) â†’ (3, 4)
# ç¬¬0è¡ŒåŠ 10ï¼Œç¬¬1è¡ŒåŠ 20ï¼Œç¬¬2è¡ŒåŠ 30
```

**è®°å¿†æŠ€å·§ï¼š**
```
arr[np.newaxis, :]  â†’ åœ¨"å‰é¢"åŠ ç»´åº¦ â†’ è¡Œå‘é‡ (1, n)
arr[:, np.newaxis]  â†’ åœ¨"åé¢"åŠ ç»´åº¦ â†’ åˆ—å‘é‡ (n, 1)

ç®€åŒ–è®°å¿†ï¼š
arr[None, :]  â†’ è¡Œ
arr[:, None]  â†’ åˆ—
```

---

### æ ¸å¿ƒæ¦‚å¿µ3ï¼šä¸‰ç»´å¹¿æ’­ä¸æ‰¹é‡è®¡ç®— ğŸš€

**å‘é‡æ•°æ®åº“æœ€é‡è¦çš„åº”ç”¨ï¼šæ‰¹é‡æˆå¯¹è®¡ç®—**

**åœºæ™¯ï¼šè®¡ç®—æ‰€æœ‰æŸ¥è¯¢ä¸æ‰€æœ‰æ–‡æ¡£çš„ç›¸ä¼¼åº¦**

```python
# æ•°æ®
queries = np.random.rand(5, 768)    # 5ä¸ªæŸ¥è¯¢
docs = np.random.rand(1000, 768)    # 1000ä¸ªæ–‡æ¡£

# ç›®æ ‡ï¼šè®¡ç®—5Ã—1000çš„ç›¸ä¼¼åº¦çŸ©é˜µ
```

**æ–¹æ³•1ï¼šå¾ªç¯ï¼ˆæ…¢ï¼‰**
```python
similarities = np.zeros((5, 1000))
for i in range(5):
    for j in range(1000):
        similarities[i, j] = np.dot(queries[i], docs[j])
# æ—¶é—´ï¼š~1ç§’
```

**æ–¹æ³•2ï¼šçŸ©é˜µä¹˜æ³•ï¼ˆæ¨èï¼‰**
```python
similarities = queries @ docs.T  # (5, 768) @ (768, 1000) â†’ (5, 1000)
# æ—¶é—´ï¼š~0.01ç§’
```

**æ–¹æ³•3ï¼šå¹¿æ’­ï¼ˆæ•™å­¦ç›®çš„ï¼Œç†è§£åŸç†ï¼‰**
```python
# æ‰©å±•ç»´åº¦
q = queries[:, np.newaxis, :]  # (5, 1, 768)
d = docs[np.newaxis, :, :]     # (1, 1000, 768)

# å¹¿æ’­ç›¸ä¹˜
# q: (5, 1, 768) â†’ å¹¿æ’­åˆ° (5, 1000, 768)
# d: (1, 1000, 768) â†’ å¹¿æ’­åˆ° (5, 1000, 768)
products = q * d  # (5, 1000, 768)

# æ±‚å’Œå¾—åˆ°ç‚¹ç§¯
similarities = products.sum(axis=2)  # (5, 1000)
```

**ä¸‰ç»´å¹¿æ’­å¯è§†åŒ–ï¼š**
```
querieså½¢çŠ¶: (5, 768)
docså½¢çŠ¶:    (1000, 768)

æ­¥éª¤1ï¼šæ‰©å±•ç»´åº¦
q = queries[:, np.newaxis, :]  â†’ (5, 1, 768)
d = docs[np.newaxis, :, :]     â†’ (1, 1000, 768)

æ­¥éª¤2ï¼šå¹¿æ’­å¯¹é½
q: (5,    1, 768)
d: (1, 1000, 768)
    â†“     â†“    â†“
   5vs1 1vs1000 768vs768
   æ‰©å±•   æ‰©å±•    åŒ¹é…

æ­¥éª¤3ï¼šå¹¿æ’­ç»“æœ
(5, 1000, 768)

æ­¥éª¤4ï¼šæ²¿axis=2æ±‚å’Œ
(5, 1000)  â† æ¯ä¸ªæŸ¥è¯¢ä¸æ¯ä¸ªæ–‡æ¡£çš„ç›¸ä¼¼åº¦
```

**è®¡ç®—æˆå¯¹è·ç¦»ï¼š**
```python
# ç‚¹é›†
points = np.random.rand(100, 3)  # 100ä¸ª3Dç‚¹

# æ‰©å±•ç»´åº¦
p1 = points[:, np.newaxis, :]  # (100, 1, 3)
p2 = points[np.newaxis, :, :]  # (1, 100, 3)

# å¹¿æ’­ç›¸å‡
diff = p1 - p2  # (100, 100, 3)

# æ¬§æ°è·ç¦»
distances = np.sqrt((diff ** 2).sum(axis=2))  # (100, 100)

# distances[i, j] = ç‚¹iå’Œç‚¹jä¹‹é—´çš„è·ç¦»
```

---

## 4. ã€æœ€å°å¯ç”¨ã€‘æŒæ¡20%è§£å†³80%é—®é¢˜

æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½åœ¨å‘é‡æ•°æ®åº“ä¸­çµæ´»ä½¿ç”¨np.newaxisï¼š

### 4.1 åŸºæœ¬è¯­æ³•

```python
import numpy as np

arr = np.array([1, 2, 3])  # (3,)

# è¡Œå‘é‡
row = arr[np.newaxis, :]  # (1, 3)
row = arr[None, :]        # ç­‰ä»·å†™æ³•

# åˆ—å‘é‡
col = arr[:, np.newaxis]  # (3, 1)
col = arr[:, None]        # ç­‰ä»·å†™æ³•
```

### 4.2 çŸ©é˜µåŠ è¡Œ/åˆ—å‘é‡

```python
matrix = np.ones((3, 4))  # (3, 4)

# æ¯è¡ŒåŠ ä¸Š [1, 2, 3, 4]
row_add = np.array([1, 2, 3, 4])  # (4,)
result = matrix + row_add  # è‡ªåŠ¨å¹¿æ’­

# æ¯åˆ—åŠ ä¸Š [10, 20, 30]
col_add = np.array([10, 20, 30])  # (3,)
col_add_2d = col_add[:, np.newaxis]  # (3, 1)
result = matrix + col_add_2d
```

### 4.3 å¤–ç§¯è®¡ç®—

```python
a = np.array([1, 2, 3])      # (3,)
b = np.array([10, 20, 30])   # (3,)

# å¤–ç§¯ï¼ša[i] * b[j] çš„æ‰€æœ‰ç»„åˆ
outer = a[:, np.newaxis] * b[np.newaxis, :]  # (3, 3)
# æˆ–ç®€åŒ–ä¸º
outer = a[:, None] * b[None, :]  # (3, 3)
```

### 4.4 æ‰¹é‡å½’ä¸€åŒ–çš„åˆ†æ¯

```python
embeddings = np.random.rand(1000, 768)  # (1000, 768)

# è®¡ç®—æ¯è¡Œçš„èŒƒæ•°
norms = np.linalg.norm(embeddings, axis=1)  # (1000,)

# éœ€è¦å˜æˆ (1000, 1) æ‰èƒ½å¹¿æ’­é™¤æ³•
norms_2d = norms[:, np.newaxis]  # (1000, 1)
normalized = embeddings / norms_2d  # (1000, 768)

# æ›´ç®€æ´ï¼šç›´æ¥ç”¨keepdims
norms_2d = np.linalg.norm(embeddings, axis=1, keepdims=True)
normalized = embeddings / norms_2d
```

### 4.5 æˆå¯¹è·ç¦»çŸ©é˜µ

```python
points = np.array([[1, 2], [3, 4], [5, 6]])  # (3, 2)

# æ‰©å±•ç»´åº¦
p1 = points[:, np.newaxis, :]  # (3, 1, 2)
p2 = points[np.newaxis, :, :]  # (1, 3, 2)

# å¹¿æ’­ç›¸å‡
diff = p1 - p2  # (3, 3, 2)

# è®¡ç®—è·ç¦»
distances = np.sqrt((diff ** 2).sum(axis=2))  # (3, 3)
```

**è¿™äº›çŸ¥è¯†è¶³ä»¥ï¼š**
- âœ… æ­£ç¡®ä½¿ç”¨np.newaxisæ‰©å±•ç»´åº¦
- âœ… ç†è§£è¡Œå‘é‡å’Œåˆ—å‘é‡çš„åŒºåˆ«
- âœ… å®ç°æ‰¹é‡å½’ä¸€åŒ–
- âœ… è®¡ç®—æˆå¯¹è·ç¦»/ç›¸ä¼¼åº¦
- âœ… ä¸ºå‘é‡æ•°æ®åº“æ‰¹é‡æ“ä½œæ‰“åŸºç¡€

---

## 5. ã€1ä¸ªç±»æ¯”ã€‘ç”¨å‰ç«¯å¼€å‘ç†è§£np.newaxis

### ç±»æ¯”1ï¼šnp.newaxis = CSS Flexboxçš„æ–¹å‘ ğŸ¨

**Flexboxæ”¹å˜æ’åˆ—æ–¹å‘ï¼š**
```css
/* é»˜è®¤ï¼šè¡Œæ–¹å‘ï¼ˆæ°´å¹³ï¼‰ */
.container {
  display: flex;
  flex-direction: row;  /* å…ƒç´ æ°´å¹³æ’åˆ— */
}

/* åˆ—æ–¹å‘ï¼ˆå‚ç›´ï¼‰ */
.container {
  display: flex;
  flex-direction: column;  /* å…ƒç´ å‚ç›´æ’åˆ— */
}
```

```python
# np.newaxisæ”¹å˜"æ’åˆ—æ–¹å‘"
arr = np.array([1, 2, 3])  # ä¸€ç»´æ•°ç»„

# "è¡Œæ–¹å‘"
arr[np.newaxis, :]  # [[1, 2, 3]]  æ°´å¹³æ’åˆ—

# "åˆ—æ–¹å‘"
arr[:, np.newaxis]  # [[1], [2], [3]]  å‚ç›´æ’åˆ—
```

**ç›¸ä¼¼ç‚¹ï¼š**
- CSS flex-directionæ§åˆ¶å­å…ƒç´ æ’åˆ—æ–¹å‘
- np.newaxisæ§åˆ¶æ•°æ®çš„"å±•å¼€æ–¹å‘"

---

### ç±»æ¯”2ï¼šnp.newaxis = æ•°ç»„çš„wrap ğŸ“¦

```javascript
// JavaScriptä¸­çš„wrap
const arr = [1, 2, 3];

// wrapæˆè¡Œï¼ˆå¤–å±‚æ•°ç»„åŒ…ä¸€å±‚ï¼‰
const row = [arr];  // [[1, 2, 3]]

// wrapæˆåˆ—ï¼ˆæ¯ä¸ªå…ƒç´ åŒ…ä¸€å±‚ï¼‰
const col = arr.map(x => [x]);  // [[1], [2], [3]]
```

```python
# NumPyä¸­çš„np.newaxis
arr = np.array([1, 2, 3])

# "wrap"æˆè¡Œ
row = arr[np.newaxis, :]  # [[1, 2, 3]]

# "wrap"æˆåˆ—
col = arr[:, np.newaxis]  # [[1], [2], [3]]
```

---

### ç±»æ¯”3ï¼šç»´åº¦æ‰©å±• = æ•°æ®åµŒå¥—å±‚çº§ ğŸ¯

```javascript
// ä¸€ç»´æ•°æ®
const data1D = [1, 2, 3];

// äºŒç»´æ•°æ®ï¼ˆè¡Œï¼‰
const data2D_row = [[1, 2, 3]];  // 1è¡Œ3åˆ—

// äºŒç»´æ•°æ®ï¼ˆåˆ—ï¼‰
const data2D_col = [[1], [2], [3]];  // 3è¡Œ1åˆ—

// ä¸‰ç»´æ•°æ®
const data3D = [[[1, 2, 3]]];  // 1Ã—1Ã—3
```

```python
# NumPyç­‰ä»·æ“ä½œ
arr = np.array([1, 2, 3])  # (3,)

arr[np.newaxis, :]  # (1, 3) - å¤–å±‚åŠ ä¸€å±‚
arr[:, np.newaxis]  # (3, 1) - æ¯å…ƒç´ åŠ ä¸€å±‚
arr[np.newaxis, :, np.newaxis]  # (1, 3, 1) - ä¸¤ç«¯éƒ½åŠ 
```

---

### ç±»æ¯”4ï¼šå¹¿æ’­ = CSS Gridçš„auto-fill ğŸ“

```css
/* CSS Gridè‡ªåŠ¨å¡«å…… */
.container {
  display: grid;
  grid-template-columns: repeat(auto-fill, 100px);
}
/* ä¸€ä¸ª100pxçš„æ¨¡æ¿ï¼Œè‡ªåŠ¨é‡å¤å¡«å……æ•´è¡Œ */
```

```python
# NumPyå¹¿æ’­ï¼šå°æ•°ç»„"è‡ªåŠ¨é‡å¤"
row = np.array([1, 2, 3, 4])  # æ¨¡æ¿
matrix = np.ones((3, 4))

result = matrix + row  # rowè‡ªåŠ¨"é‡å¤"3æ¬¡
# [[2, 3, 4, 5],
#  [2, 3, 4, 5],
#  [2, 3, 4, 5]]
```

**ç›¸ä¼¼ç‚¹ï¼š**
- CSS auto-fillï¼šæ¨¡æ¿è‡ªåŠ¨é‡å¤
- NumPyå¹¿æ’­ï¼šå°æ•°ç»„è‡ªåŠ¨"è™šæ‹Ÿé‡å¤"

---

### ç±»æ¯”5ï¼šä¸‰ç»´å¹¿æ’­ = åµŒå¥—å¾ªç¯çš„å‘é‡åŒ– ğŸ”„

```javascript
// JavaScriptåµŒå¥—å¾ªç¯
const queries = [[1, 2], [3, 4]];  // 2ä¸ªæŸ¥è¯¢
const docs = [[5, 6], [7, 8], [9, 10]];  // 3ä¸ªæ–‡æ¡£

// è®¡ç®—æ‰€æœ‰æˆå¯¹ç‚¹ç§¯
const similarities = [];
for (let i = 0; i < queries.length; i++) {
  similarities[i] = [];
  for (let j = 0; j < docs.length; j++) {
    let dot = 0;
    for (let k = 0; k < 2; k++) {
      dot += queries[i][k] * docs[j][k];
    }
    similarities[i][j] = dot;
  }
}
// ä¸‰å±‚åµŒå¥—å¾ªç¯
```

```python
# NumPyå¹¿æ’­ï¼šæ— å¾ªç¯
queries = np.array([[1, 2], [3, 4]])      # (2, 2)
docs = np.array([[5, 6], [7, 8], [9, 10]])  # (3, 2)

# æ‰©å±•ç»´åº¦
q = queries[:, np.newaxis, :]  # (2, 1, 2)
d = docs[np.newaxis, :, :]     # (1, 3, 2)

# ä¸€è¡Œä»£ç æ›¿ä»£ä¸‰å±‚å¾ªç¯
similarities = (q * d).sum(axis=2)  # (2, 3)
```

**ç›¸ä¼¼ç‚¹ï¼š**
- å¾ªç¯åµŒå¥—çš„å±‚æ•° = æ•°ç»„çš„ç»´åº¦æ•°
- np.newaxiså¸®åŠ©æ„å»ºé«˜ç»´æ•°ç»„ï¼Œç”¨å¹¿æ’­æ›¿ä»£å¾ªç¯

---

### ç±»æ¯”æ€»ç»“è¡¨ ğŸ“Š

| NumPyæ¦‚å¿µ | å‰ç«¯ç±»æ¯” | æ ¸å¿ƒç›¸ä¼¼ç‚¹ |
|----------|---------|-----------|
| np.newaxis | flex-direction | æ§åˆ¶æ–¹å‘ |
| è¡Œå‘é‡ | rowæ–¹å‘ | æ°´å¹³å±•å¼€ |
| åˆ—å‘é‡ | columnæ–¹å‘ | å‚ç›´å±•å¼€ |
| ç»´åº¦æ‰©å±• | æ•°ç»„åµŒå¥— | å¢åŠ å±‚çº§ |
| å¹¿æ’­ | auto-fill | è‡ªåŠ¨é‡å¤ |
| ä¸‰ç»´å¹¿æ’­ | åµŒå¥—å¾ªç¯ | æ‰¹é‡ç»„åˆ |

---

## 6. ã€åç›´è§‰ç‚¹ã€‘æœ€å®¹æ˜“é”™çš„3ä¸ªè¯¯åŒº

### è¯¯åŒº1ï¼šnp.newaxisä¼šå¤åˆ¶æ•°æ® âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- np.newaxisåªåˆ›å»º**è§†å›¾**ï¼Œä¸å¤åˆ¶æ•°æ®
- è¿”å›çš„æ•°ç»„ä¸åŸæ•°ç»„**å…±äº«å†…å­˜**
- æ˜¯é›¶æˆæœ¬çš„ç»´åº¦æ‰©å±•

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
- çœ‹èµ·æ¥"å¤šäº†ä¸€ä¸ªç»´åº¦"åƒæ˜¯æ–°å»ºäº†æ•°æ®
- ä¸äº†è§£NumPyçš„è§†å›¾æœºåˆ¶
- ä¸å…¶ä»–è¯­è¨€çš„æ•°ç»„æ“ä½œæ··æ·†

**æ­£ç¡®ç†è§£ï¼š**
```python
import numpy as np

arr = np.array([1, 2, 3])
arr_expanded = arr[:, np.newaxis]

# éªŒè¯ï¼šå…±äº«å†…å­˜
print(f"å…±äº«å†…å­˜: {np.shares_memory(arr, arr_expanded)}")  # True

# éªŒè¯ï¼šä¿®æ”¹ä¸€ä¸ªå½±å“å¦ä¸€ä¸ª
arr[0] = 999
print(f"åŸæ•°ç»„: {arr}")           # [999, 2, 3]
print(f"æ‰©å±•å: {arr_expanded}")  # [[999], [2], [3]]

# å†…å­˜å ç”¨
print(f"åŸæ•°ç»„å­—èŠ‚: {arr.nbytes}")           # 24
print(f"æ‰©å±•åå­—èŠ‚: {arr_expanded.nbytes}")  # 24ï¼ˆç›¸åŒï¼ï¼‰
```

**åº•å±‚åŸç†ï¼š**
```python
# np.newaxisåªæ”¹å˜strideså’Œshapeï¼Œä¸å¤åˆ¶æ•°æ®
arr = np.array([1, 2, 3])
print(f"åŸshape: {arr.shape}, strides: {arr.strides}")
# shape: (3,), strides: (8,)

arr_exp = arr[:, np.newaxis]
print(f"æ‰©å±•shape: {arr_exp.shape}, strides: {arr_exp.strides}")
# shape: (3, 1), strides: (8, 8)

# strideså‘Šè¯‰NumPyå¦‚ä½•éå†å†…å­˜
# æ–°å¢çš„ç»´åº¦strideå¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œå› ä¸ºè¯¥ç»´åº¦é•¿åº¦ä¸º1
```

---

### è¯¯åŒº2ï¼šåªèƒ½ç”¨np.newaxisï¼Œä¸èƒ½ç”¨None âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- `np.newaxis` **å°±æ˜¯** `None`
- ä¸¤è€…å®Œå…¨ç­‰ä»·
- `None`æ›´ç®€æ´ï¼Œ`np.newaxis`æ›´æ˜ç¡®

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
- æ•™ç¨‹é€šå¸¸åªä»‹ç»np.newaxis
- ä¸çŸ¥é“å®ƒä»¬æ˜¯åŒä¸€ä¸ªä¸œè¥¿
- è§‰å¾—None"å¤ªç®€å•ä¸å¤Ÿä¸“ä¸š"

**æ­£ç¡®ç†è§£ï¼š**
```python
import numpy as np

# éªŒè¯ï¼šå®ƒä»¬æ˜¯åŒä¸€ä¸ªä¸œè¥¿
print(np.newaxis is None)  # True

arr = np.array([1, 2, 3])

# ä¸¤ç§å†™æ³•å®Œå…¨ç­‰ä»·
result1 = arr[:, np.newaxis]  # ç”¨np.newaxis
result2 = arr[:, None]        # ç”¨None

print(np.array_equal(result1, result2))  # True

# å®é™…é¡¹ç›®ä¸­ä¸¤ç§éƒ½å¸¸è§
# np.newaxisï¼šæ›´æ˜ç¡®ï¼Œæ¨èç»™åˆå­¦è€…
# Noneï¼šæ›´ç®€æ´ï¼Œè€æ‰‹å¸¸ç”¨
```

**é€‰æ‹©å»ºè®®ï¼š**
```python
# æ¨èï¼šå…³é”®ä»£ç ç”¨np.newaxisï¼Œæ›´æ¸…æ™°
embeddings[:, np.newaxis, :]  # æ˜ç¡®è¡¨ç¤º"æ’å…¥æ–°è½´"

# å¯æ¥å—ï¼šç®€å•åœºæ™¯ç”¨None
arr[:, None]  # ç®€æ´æ˜äº†
```

---

### è¯¯åŒº3ï¼šç»´åº¦æ’å…¥ä½ç½®æ— æ‰€è°“ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- ä¸åŒä½ç½®å¯¼è‡´**å®Œå…¨ä¸åŒ**çš„å¹¿æ’­è¡Œä¸º
- ä½ç½®é”™è¯¯ä¼šå¯¼è‡´å½¢çŠ¶ä¸å…¼å®¹æˆ–ç»“æœé”™è¯¯
- å¿…é¡»æ ¹æ®éœ€æ±‚é€‰æ‹©æ­£ç¡®ä½ç½®

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
- "åæ­£éƒ½æ˜¯æ’å…¥ä¸€ä¸ª1"
- æ²¡æœ‰ç†è§£å¹¿æ’­çš„å¯¹é½è§„åˆ™
- è°ƒè¯•æ—¶å‡­æ„Ÿè§‰è¯•

**æ­£ç¡®ç†è§£ï¼š**
```python
import numpy as np

arr = np.array([1, 2, 3])  # (3,)
matrix = np.ones((3, 4))   # (3, 4)

# ä½ç½®1ï¼šå‰é¢æ’å…¥ â†’ (1, 3)
arr_row = arr[np.newaxis, :]  # (1, 3)
try:
    result = matrix + arr_row
except ValueError as e:
    print(f"é”™è¯¯: {e}")
# é”™è¯¯: (3, 4) + (1, 3) ä¸å…¼å®¹ï¼

# ä½ç½®2ï¼šåé¢æ’å…¥ â†’ (3, 1)
arr_col = arr[:, np.newaxis]  # (3, 1)
result = matrix + arr_col  # (3, 4) + (3, 1) â†’ å¯ä»¥å¹¿æ’­
print(f"æˆåŠŸ: {result.shape}")  # (3, 4)
```

**ä¸‰ç»´åœºæ™¯æ›´å¤æ‚ï¼š**
```python
queries = np.random.rand(5, 768)    # (5, 768)
docs = np.random.rand(1000, 768)    # (1000, 768)

# æ­£ç¡®ï¼šæŸ¥è¯¢åœ¨å‰ï¼Œæ–‡æ¡£åœ¨ä¸­
q = queries[:, np.newaxis, :]  # (5, 1, 768)
d = docs[np.newaxis, :, :]     # (1, 1000, 768)
# å¹¿æ’­ï¼š(5, 1000, 768) âœ…

# é”™è¯¯ï¼šä½ç½®æå
q_wrong = queries[np.newaxis, :, :]  # (1, 5, 768)
d_wrong = docs[:, np.newaxis, :]     # (1000, 1, 768)
# å¹¿æ’­ï¼š(1000, 5, 768) â† ç»´åº¦é¡ºåºä¸å¯¹ï¼
```

**è®°å¿†æŠ€å·§ï¼š**
```
æƒ³è¦çš„ç»“æœå½¢çŠ¶ï¼š(queriesæ•°, docsæ•°, dim)
                   â†“        â†“      â†“
queriesæ‰©å±•ï¼š     (5,       1,   768)  â†’ ä¸­é—´åŠ newaxis
docsæ‰©å±•ï¼š        (1,    1000,   768)  â†’ å‰é¢åŠ newaxis
```

---

## 7. ã€å®æˆ˜ä»£ç ã€‘ä¸€ä¸ªèƒ½è·‘çš„ä¾‹å­

```python
import numpy as np
import time

print("=" * 70)
print(" np.newaxisä¸å¹¿æ’­æœºåˆ¶å®Œæ•´ç¤ºä¾‹")
print("=" * 70)

# ===== 1. åŸºæœ¬ç”¨æ³• =====
print("\n=== 1. np.newaxisåŸºæœ¬ç”¨æ³• ===\n")

arr = np.array([1, 2, 3, 4, 5])
print(f"åŸæ•°ç»„: {arr}")
print(f"åŸå½¢çŠ¶: {arr.shape}")

# è¡Œå‘é‡
row = arr[np.newaxis, :]
print(f"\nè¡Œå‘é‡: {row}")
print(f"è¡Œå‘é‡å½¢çŠ¶: {row.shape}")

# åˆ—å‘é‡
col = arr[:, np.newaxis]
print(f"\nåˆ—å‘é‡:\n{col}")
print(f"åˆ—å‘é‡å½¢çŠ¶: {col.shape}")

# Noneç­‰ä»·
print(f"\nnp.newaxis is None: {np.newaxis is None}")

# ===== 2. éªŒè¯è§†å›¾ç‰¹æ€§ =====
print("\n=== 2. è§†å›¾ç‰¹æ€§éªŒè¯ ===\n")

arr = np.array([1, 2, 3])
arr_exp = arr[:, np.newaxis]

print(f"å…±äº«å†…å­˜: {np.shares_memory(arr, arr_exp)}")
print(f"åŸæ•°ç»„å­—èŠ‚: {arr.nbytes}")
print(f"æ‰©å±•åå­—èŠ‚: {arr_exp.nbytes}")

# ä¿®æ”¹åŸæ•°ç»„
arr[0] = 999
print(f"\nä¿®æ”¹å:")
print(f"åŸæ•°ç»„: {arr}")
print(f"æ‰©å±•å:\n{arr_exp}")

# ===== 3. çŸ©é˜µåŠ è¡Œ/åˆ—å‘é‡ =====
print("\n=== 3. çŸ©é˜µåŠ è¡Œ/åˆ—å‘é‡ ===\n")

matrix = np.ones((3, 4), dtype=int)
row_vec = np.array([1, 2, 3, 4])
col_vec = np.array([10, 20, 30])

print(f"çŸ©é˜µ (3Ã—4):\n{matrix}")
print(f"è¡Œå‘é‡: {row_vec}")
print(f"åˆ—å‘é‡: {col_vec}")

# åŠ è¡Œå‘é‡ï¼ˆè‡ªåŠ¨å¹¿æ’­ï¼‰
result_row = matrix + row_vec
print(f"\nçŸ©é˜µ + è¡Œå‘é‡:\n{result_row}")

# åŠ åˆ—å‘é‡ï¼ˆéœ€è¦æ‰©å±•ç»´åº¦ï¼‰
col_vec_2d = col_vec[:, np.newaxis]
result_col = matrix + col_vec_2d
print(f"\nçŸ©é˜µ + åˆ—å‘é‡:\n{result_col}")

# ===== 4. å¤–ç§¯è®¡ç®— =====
print("\n=== 4. å¤–ç§¯è®¡ç®— ===\n")

a = np.array([1, 2, 3])
b = np.array([10, 20, 30, 40])

print(f"a = {a}")
print(f"b = {b}")

# å¤–ç§¯
outer = a[:, np.newaxis] * b[np.newaxis, :]
print(f"\nå¤–ç§¯ (a Ã— b):\n{outer}")
print(f"å½¢çŠ¶: {outer.shape}")

# éªŒè¯
print(f"\néªŒè¯: a[0]*b = {a[0] * b}")
print(f"å¤–ç§¯ç¬¬0è¡Œ: {outer[0]}")

# ===== 5. æˆå¯¹è·ç¦»è®¡ç®— =====
print("\n=== 5. æˆå¯¹è·ç¦»è®¡ç®— ===\n")

# 5ä¸ª2ç»´ç‚¹
points = np.array([
    [0, 0],
    [1, 0],
    [0, 1],
    [1, 1],
    [0.5, 0.5]
], dtype=float)

print(f"ç‚¹é›†:\n{points}")

# æ‰©å±•ç»´åº¦
p1 = points[:, np.newaxis, :]  # (5, 1, 2)
p2 = points[np.newaxis, :, :]  # (1, 5, 2)

print(f"\np1å½¢çŠ¶: {p1.shape}")
print(f"p2å½¢çŠ¶: {p2.shape}")

# å¹¿æ’­ç›¸å‡
diff = p1 - p2  # (5, 5, 2)
print(f"diffå½¢çŠ¶: {diff.shape}")

# è®¡ç®—è·ç¦»
distances = np.sqrt((diff ** 2).sum(axis=2))
print(f"\nè·ç¦»çŸ©é˜µ:\n{np.round(distances, 2)}")

# ===== 6. æ‰¹é‡ç›¸ä¼¼åº¦è®¡ç®— =====
print("\n=== 6. æ‰¹é‡ç›¸ä¼¼åº¦è®¡ç®— ===\n")

# 3ä¸ªæŸ¥è¯¢ï¼Œ4ä¸ªæ–‡æ¡£ï¼Œ8ç»´
np.random.seed(42)
queries = np.random.rand(3, 8)
docs = np.random.rand(4, 8)

print(f"æŸ¥è¯¢æ•°: {queries.shape[0]}")
print(f"æ–‡æ¡£æ•°: {docs.shape[0]}")
print(f"ç»´åº¦: {queries.shape[1]}")

# æ–¹æ³•1ï¼šçŸ©é˜µä¹˜æ³•
sims_matmul = queries @ docs.T
print(f"\næ–¹æ³•1 (çŸ©é˜µä¹˜æ³•):\n{np.round(sims_matmul, 3)}")

# æ–¹æ³•2ï¼šå¹¿æ’­
q = queries[:, np.newaxis, :]  # (3, 1, 8)
d = docs[np.newaxis, :, :]     # (1, 4, 8)
sims_broadcast = (q * d).sum(axis=2)  # (3, 4)
print(f"\næ–¹æ³•2 (å¹¿æ’­):\n{np.round(sims_broadcast, 3)}")

# éªŒè¯ç›¸åŒ
print(f"\nä¸¤ç§æ–¹æ³•ç»“æœç›¸åŒ: {np.allclose(sims_matmul, sims_broadcast)}")

# ===== 7. ä¸‰ç»´å¹¿æ’­è¯¦è§£ =====
print("\n=== 7. ä¸‰ç»´å¹¿æ’­è¯¦è§£ ===\n")

A = np.array([[1, 2], [3, 4]])  # (2, 2)
B = np.array([[10, 20, 30], [40, 50, 60]])  # (2, 3)

print(f"A (2Ã—2):\n{A}")
print(f"B (2Ã—3):\n{B}")

# æ‰©å±•A
A_exp = A[:, :, np.newaxis]  # (2, 2, 1)
print(f"\nAæ‰©å±•åå½¢çŠ¶: {A_exp.shape}")

# æ‰©å±•B
B_exp = B[:, np.newaxis, :]  # (2, 1, 3)
print(f"Bæ‰©å±•åå½¢çŠ¶: {B_exp.shape}")

# å¹¿æ’­ç›¸ä¹˜
result = A_exp * B_exp  # (2, 2, 3)
print(f"ç»“æœå½¢çŠ¶: {result.shape}")
print(f"\nç»“æœ:\n{result}")

# ===== 8. æ€§èƒ½å¯¹æ¯” =====
print("\n=== 8. æ€§èƒ½å¯¹æ¯”ï¼šå¾ªç¯ vs å¹¿æ’­ ===\n")

n_queries = 100
n_docs = 10000
dim = 128

queries = np.random.rand(n_queries, dim).astype(np.float32)
docs = np.random.rand(n_docs, dim).astype(np.float32)

print(f"æŸ¥è¯¢: {n_queries}ä¸ª")
print(f"æ–‡æ¡£: {n_docs}ä¸ª")
print(f"ç»´åº¦: {dim}")

# æ–¹æ³•1ï¼šå¾ªç¯ï¼ˆé‡‡æ ·ï¼‰
sample_docs = docs[:100]
start = time.time()
sims_loop = np.zeros((n_queries, 100))
for i in range(n_queries):
    for j in range(100):
        sims_loop[i, j] = np.dot(queries[i], sample_docs[j])
time_loop = (time.time() - start) * 100  # ä¼°ç®—

# æ–¹æ³•2ï¼šçŸ©é˜µä¹˜æ³•
start = time.time()
sims_matmul = queries @ docs.T
time_matmul = time.time() - start

# æ–¹æ³•3ï¼šå¹¿æ’­
start = time.time()
q = queries[:, np.newaxis, :]
d = docs[np.newaxis, :, :]
sims_broadcast = (q * d).sum(axis=2)
time_broadcast = time.time() - start

print(f"\nå¾ªç¯ï¼ˆä¼°ç®—ï¼‰: {time_loop:.4f}ç§’")
print(f"çŸ©é˜µä¹˜æ³•: {time_matmul:.4f}ç§’")
print(f"å¹¿æ’­: {time_broadcast:.4f}ç§’")
print(f"\næ¨èï¼šçŸ©é˜µä¹˜æ³•ï¼ˆæœ€å¿«ä¸”çœå†…å­˜ï¼‰")

# ===== 9. æ‰¹é‡å½’ä¸€åŒ– =====
print("\n=== 9. æ‰¹é‡å½’ä¸€åŒ– ===\n")

embeddings = np.random.rand(1000, 768)
print(f"åŸå§‹å½¢çŠ¶: {embeddings.shape}")

# è®¡ç®—èŒƒæ•°
norms = np.linalg.norm(embeddings, axis=1)
print(f"èŒƒæ•°å½¢çŠ¶: {norms.shape}")

# éœ€è¦æ‰©å±•ç»´åº¦æ‰èƒ½å¹¿æ’­
norms_2d = norms[:, np.newaxis]
print(f"æ‰©å±•åå½¢çŠ¶: {norms_2d.shape}")

# å½’ä¸€åŒ–
normalized = embeddings / norms_2d
print(f"å½’ä¸€åŒ–åå½¢çŠ¶: {normalized.shape}")

# éªŒè¯
check_norms = np.linalg.norm(normalized, axis=1)
print(f"å½’ä¸€åŒ–åèŒƒæ•°: {check_norms[:5]}")

# æ›´ç®€æ´çš„æ–¹å¼
norms_keepdims = np.linalg.norm(embeddings, axis=1, keepdims=True)
print(f"\nkeepdims=Trueæ—¶çš„å½¢çŠ¶: {norms_keepdims.shape}")

# ===== 10. å‘é‡æ•°æ®åº“åœºæ™¯ =====
print("\n=== 10. å‘é‡æ•°æ®åº“åœºæ™¯ï¼šTop-Kæ£€ç´¢ ===\n")

# æ¨¡æ‹Ÿæ•°æ®
np.random.seed(123)
n_docs = 10000
dim = 128
k = 5

# æ–‡æ¡£å‘é‡ï¼ˆå·²å½’ä¸€åŒ–ï¼‰
docs = np.random.rand(n_docs, dim).astype(np.float32)
docs = docs / np.linalg.norm(docs, axis=1, keepdims=True)

# æŸ¥è¯¢å‘é‡ï¼ˆå·²å½’ä¸€åŒ–ï¼‰
queries = np.random.rand(3, dim).astype(np.float32)
queries = queries / np.linalg.norm(queries, axis=1, keepdims=True)

print(f"æ–‡æ¡£æ•°: {n_docs}")
print(f"æŸ¥è¯¢æ•°: {queries.shape[0]}")
print(f"Top-K: {k}")

# è®¡ç®—ç›¸ä¼¼åº¦
start = time.time()
similarities = queries @ docs.T  # (3, 10000)
search_time = time.time() - start

# æ‰¾Top-K
start = time.time()
for i, query_sims in enumerate(similarities):
    top_k_idx = np.argpartition(query_sims, -k)[-k:]
    top_k_idx = top_k_idx[np.argsort(query_sims[top_k_idx])[::-1]]
    top_k_scores = query_sims[top_k_idx]
    
    print(f"\næŸ¥è¯¢{i+1} Top-{k}:")
    for idx, score in zip(top_k_idx, top_k_scores):
        print(f"  æ–‡æ¡£{idx}: {score:.4f}")

topk_time = time.time() - start

print(f"\næœç´¢è€—æ—¶: {search_time*1000:.2f}ms")
print(f"æ’åºè€—æ—¶: {topk_time*1000:.2f}ms")

# ===== 11. å¸¸è§é”™è¯¯ç¤ºä¾‹ =====
print("\n=== 11. å¸¸è§é”™è¯¯ä¸ä¿®æ­£ ===\n")

# é”™è¯¯1ï¼šç»´åº¦ä½ç½®é”™è¯¯
matrix = np.ones((3, 4))
vec = np.array([1, 2, 3])

print("çŸ©é˜µå½¢çŠ¶:", matrix.shape)
print("å‘é‡å½¢çŠ¶:", vec.shape)

try:
    # é”™è¯¯ï¼šè¯•å›¾åŠ ä¸Šä¸å…¼å®¹çš„å½¢çŠ¶
    result = matrix + vec[np.newaxis, :]  # (3,4) + (1,3) â†’ é”™è¯¯
except ValueError as e:
    print(f"é”™è¯¯: {e}")

# æ­£ç¡®ï¼šä½¿ç”¨æ­£ç¡®çš„ç»´åº¦ä½ç½®
result = matrix + vec[:, np.newaxis]  # (3,4) + (3,1) â†’ æ­£ç¡®
print(f"ä¿®æ­£åæˆåŠŸï¼Œå½¢çŠ¶: {result.shape}")

print("\n" + "=" * 70)
print(" æ‰€æœ‰ç¤ºä¾‹å®Œæˆï¼")
print("=" * 70)
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**
```
======================================================================
 np.newaxisä¸å¹¿æ’­æœºåˆ¶å®Œæ•´ç¤ºä¾‹
======================================================================

=== 1. np.newaxisåŸºæœ¬ç”¨æ³• ===

åŸæ•°ç»„: [1 2 3 4 5]
åŸå½¢çŠ¶: (5,)

è¡Œå‘é‡: [[1 2 3 4 5]]
è¡Œå‘é‡å½¢çŠ¶: (1, 5)

åˆ—å‘é‡:
[[1]
 [2]
 [3]
 [4]
 [5]]
åˆ—å‘é‡å½¢çŠ¶: (5, 1)

np.newaxis is None: True

...
```

---

## 8. ã€é¢è¯•å¿…é—®ã€‘å¦‚æœè¢«é—®åˆ°ï¼Œæ€ä¹ˆç­”å‡ºå½©

### é—®é¢˜ï¼š"np.newaxisæ˜¯ä»€ä¹ˆï¼Ÿå®ƒå’Œreshapeæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"np.newaxisç”¨æ¥å¢åŠ ç»´åº¦ï¼Œreshapeä¹Ÿå¯ä»¥æ”¹å˜å½¢çŠ¶ã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **np.newaxisæ˜¯NumPyä¸­ç”¨äºæ’å…¥æ–°ç»´åº¦çš„è¯­æ³•ç³–ï¼Œæœ‰å‡ ä¸ªå…³é”®ç‚¹ï¼š**
>
> 1. **æœ¬è´¨**
>    - np.newaxiså°±æ˜¯None
>    - åœ¨ç´¢å¼•ä¸­ä½¿ç”¨ï¼Œä¼šåœ¨æŒ‡å®šä½ç½®æ’å…¥é•¿åº¦ä¸º1çš„ç»´åº¦
>    - `arr[:, np.newaxis]` å°†(n,)å˜æˆ(n, 1)
>
> 2. **ä¸reshapeçš„åŒºåˆ«**
>    - np.newaxisï¼š**åªèƒ½æ’å…¥ç»´åº¦**ï¼Œè¯­ä¹‰æ˜ç¡®
>    - reshapeï¼š**ä»»æ„é‡å¡‘**ï¼Œæ›´é€šç”¨ä½†ä¸é‚£ä¹ˆç›´è§‚
>    - np.newaxisæ€»æ˜¯è¿”å›è§†å›¾ï¼Œreshapeåœ¨æŸäº›æƒ…å†µå¯èƒ½å¤åˆ¶
>
>    ```python
>    arr = np.array([1, 2, 3])  # (3,)
>    
>    # ä¸¤è€…ç»“æœç›¸åŒ
>    arr[:, np.newaxis]  # (3, 1)
>    arr.reshape(-1, 1)  # (3, 1)
>    
>    # ä½†è¯­ä¹‰ä¸åŒ
>    # np.newaxisï¼šæ˜ç¡®è¡¨ç¤º"åœ¨è¿™é‡Œæ’å…¥æ–°è½´"
>    # reshapeï¼šæ›´é€šç”¨çš„"é‡å¡‘å½¢çŠ¶"
>    ```
>
> 3. **åœ¨å‘é‡æ•°æ®åº“ä¸­çš„åº”ç”¨**
>    - æ‰¹é‡å½’ä¸€åŒ–ï¼š`norms[:, np.newaxis]`ä½¿èŒƒæ•°å˜æˆ(N, 1)ä¾¿äºå¹¿æ’­é™¤æ³•
>    - æˆå¯¹è·ç¦»ï¼š`points[:, np.newaxis, :]`å’Œ`points[np.newaxis, :, :]`å®ç°å¹¿æ’­
>    - æ‰¹é‡ç›¸ä¼¼åº¦ï¼šæ‰©å±•ç»´åº¦åä¸€æ¬¡è®¡ç®—æ‰€æœ‰æŸ¥è¯¢ä¸æ‰€æœ‰æ–‡æ¡£çš„ç›¸ä¼¼åº¦
>
> 4. **æ€§èƒ½ç‰¹ç‚¹**
>    - é›¶æˆæœ¬ï¼šä¸å¤åˆ¶æ•°æ®ï¼Œåªåˆ›å»ºè§†å›¾
>    - è¿”å›çš„æ•°ç»„ä¸åŸæ•°ç»„å…±äº«å†…å­˜
>    - å¯ä»¥ç”¨äºå®ç°é«˜æ•ˆçš„æ‰¹é‡è®¡ç®—

**ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©ï¼Ÿ**
1. âœ… è§£é‡Šäº†æœ¬è´¨ï¼ˆnp.newaxis is Noneï¼‰
2. âœ… æ˜ç¡®å¯¹æ¯”äº†ä¸reshapeçš„åŒºåˆ«
3. âœ… ç»™å‡ºäº†ä»£ç ç¤ºä¾‹
4. âœ… è”ç³»äº†å®é™…åº”ç”¨åœºæ™¯
5. âœ… æåˆ°äº†æ€§èƒ½ç‰¹ç‚¹ï¼ˆé›¶æˆæœ¬è§†å›¾ï¼‰

---

### å»¶ä¼¸é—®é¢˜ï¼š"å¦‚ä½•ç”¨å¹¿æ’­è®¡ç®—æˆå¯¹è·ç¦»çŸ©é˜µï¼Ÿ"

**å‡ºå½©å›ç­”ï¼š**

> **æ ¸å¿ƒæ€è·¯ï¼šåˆ©ç”¨np.newaxisæ‰©å±•ç»´åº¦ï¼Œè®©ä¸¤ä¸ªç‚¹é›†èƒ½å¤Ÿå¹¿æ’­ç›¸å‡**
>
> ```python
> # Nä¸ªç‚¹ï¼Œæ¯ä¸ªDç»´
> points = np.random.rand(N, D)  # (N, D)
> 
> # æ­¥éª¤1ï¼šæ‰©å±•ç»´åº¦
> p1 = points[:, np.newaxis, :]  # (N, 1, D)
> p2 = points[np.newaxis, :, :]  # (1, N, D)
> 
> # æ­¥éª¤2ï¼šå¹¿æ’­ç›¸å‡
> diff = p1 - p2  # (N, N, D)
> # diff[i, j, :] = points[i] - points[j]
> 
> # æ­¥éª¤3ï¼šè®¡ç®—æ¬§æ°è·ç¦»
> distances = np.sqrt((diff ** 2).sum(axis=2))  # (N, N)
> # distances[i, j] = ||points[i] - points[j]||
> ```
>
> **åŸç†ï¼š**
> - p1çš„å½¢çŠ¶(N, 1, D)è¡¨ç¤º"Nä¸ªç‚¹ï¼Œæ¯ä¸ªç‚¹å‡†å¤‡ä¸1ä¸ªç‚¹æ¯”è¾ƒ"
> - p2çš„å½¢çŠ¶(1, N, D)è¡¨ç¤º"1ä¸ªç‚¹å‡†å¤‡ä¸Nä¸ªç‚¹æ¯”è¾ƒ"
> - å¹¿æ’­å(N, N, D)è¡¨ç¤º"NÃ—Nå¯¹ç‚¹çš„å·®å€¼"
>
> **æ€§èƒ½ï¼š**
> - æ¯”åŒé‡å¾ªç¯å¿«100-1000å€
> - ä½†å†…å­˜å ç”¨O(NÂ²D)ï¼Œå¤§è§„æ¨¡æ•°æ®è¦åˆ†å—å¤„ç†

---

## 9. ã€åŒ–éª¨ç»µæŒã€‘10ä¸ª2åˆ†é’ŸçŸ¥è¯†å¡ç‰‡

### å¡ç‰‡1ï¼šnp.newaxisçš„æœ¬è´¨ ğŸ¯

**ä¸€å¥è¯ï¼š** np.newaxiså°±æ˜¯Noneï¼Œç”¨äºåœ¨ç´¢å¼•ä¸­æ’å…¥æ–°ç»´åº¦

**ä»£ç ï¼š**
```python
arr = np.array([1, 2, 3])  # (3,)

# ä¸¤ç§å†™æ³•ç­‰ä»·
arr[np.newaxis, :]  # (1, 3)
arr[None, :]        # (1, 3)

# éªŒè¯
print(np.newaxis is None)  # True
```

**è®°ä½ï¼š** np.newaxis = Noneï¼Œæ›´æ˜ç¡®ï¼›Noneæ›´ç®€æ´

---

### å¡ç‰‡2ï¼šè¡Œå‘é‡ä¸åˆ—å‘é‡ ğŸ“

**è¯­æ³•ï¼š**
```python
arr = np.array([1, 2, 3])  # (3,)

# è¡Œå‘é‡ï¼šå‰é¢åŠ 
row = arr[np.newaxis, :]  # (1, 3)

# åˆ—å‘é‡ï¼šåé¢åŠ 
col = arr[:, np.newaxis]  # (3, 1)
```

**è®°å¿†ï¼š**
- `[np.newaxis, :]` â†’ è¡Œï¼ˆRowï¼‰
- `[:, np.newaxis]` â†’ åˆ—ï¼ˆColumnï¼‰

---

### å¡ç‰‡3ï¼šè§†å›¾ç‰¹æ€§ ğŸ‘ï¸

**ä¸€å¥è¯ï¼š** np.newaxisä¸å¤åˆ¶æ•°æ®ï¼Œåªåˆ›å»ºè§†å›¾

```python
arr = np.array([1, 2, 3])
arr_exp = arr[:, np.newaxis]

# å…±äº«å†…å­˜
np.shares_memory(arr, arr_exp)  # True

# ä¿®æ”¹åŸæ•°ç»„å½±å“æ‰©å±•åçš„
arr[0] = 999
print(arr_exp)  # [[999], [2], [3]]
```

**æ„ä¹‰ï¼š** é›¶æˆæœ¬çš„ç»´åº¦æ‰©å±•ï¼

---

### å¡ç‰‡4ï¼šå¹¿æ’­å¯¹é½ ğŸ”„

**é—®é¢˜ï¼š** å¦‚ä½•è®©(3,)å’Œ(3, 4)èƒ½å¤Ÿè¿ç®—ï¼Ÿ

```python
matrix = np.ones((3, 4))
vec = np.array([1, 2, 3])  # (3,)

# ç›´æ¥åŠ ï¼šå½¢çŠ¶ä¸å…¼å®¹
# (3, 4) + (3,) â†’ 3 vs 4 ä¸åŒ¹é…

# æ‰©å±•åï¼šå½¢çŠ¶å…¼å®¹
vec_2d = vec[:, np.newaxis]  # (3, 1)
result = matrix + vec_2d  # (3, 4) + (3, 1) â†’ OK
```

---

### å¡ç‰‡5ï¼šå¤–ç§¯å…¬å¼ âœ–ï¸

**å…¬å¼ï¼š** outer[i, j] = a[i] * b[j]

```python
a = np.array([1, 2, 3])
b = np.array([10, 20])

# å¤–ç§¯
outer = a[:, np.newaxis] * b[np.newaxis, :]
# [[10, 20],
#  [20, 40],
#  [30, 60]]
```

**å½¢çŠ¶ï¼š** (m,) Ã— (n,) â†’ (m, n)

---

### å¡ç‰‡6ï¼šæˆå¯¹è·ç¦» ğŸ“

**ä»£ç æ¨¡æ¿ï¼š**
```python
points = np.random.rand(100, 3)  # 100ä¸ª3Dç‚¹

# æ‰©å±•
p1 = points[:, np.newaxis, :]  # (100, 1, 3)
p2 = points[np.newaxis, :, :]  # (1, 100, 3)

# è·ç¦»çŸ©é˜µ
diff = p1 - p2  # (100, 100, 3)
distances = np.sqrt((diff**2).sum(axis=2))  # (100, 100)
```

**åº”ç”¨ï¼š** èšç±»ã€KNNã€å‘é‡æ£€ç´¢

---

### å¡ç‰‡7ï¼šæ‰¹é‡ç›¸ä¼¼åº¦ ğŸ”

**ä¸¤ç§æ–¹æ³•ï¼š**
```python
queries = np.random.rand(5, 768)   # 5ä¸ªæŸ¥è¯¢
docs = np.random.rand(1000, 768)   # 1000ä¸ªæ–‡æ¡£

# æ–¹æ³•1ï¼šçŸ©é˜µä¹˜æ³•ï¼ˆæ¨èï¼‰
sims = queries @ docs.T  # (5, 1000)

# æ–¹æ³•2ï¼šå¹¿æ’­ï¼ˆç†è§£åŸç†ï¼‰
q = queries[:, np.newaxis, :]  # (5, 1, 768)
d = docs[np.newaxis, :, :]     # (1, 1000, 768)
sims = (q * d).sum(axis=2)     # (5, 1000)
```

---

### å¡ç‰‡8ï¼škeepdimså‚æ•° ğŸ”§

**é—®é¢˜ï¼š** ä¸ºä»€ä¹ˆæœ‰æ—¶éœ€è¦keepdimsï¼Ÿ

```python
arr = np.random.rand(100, 768)

# ä¸ä¿æŒç»´åº¦
norms = np.linalg.norm(arr, axis=1)  # (100,)
# arr / norms â†’ å½¢çŠ¶ä¸å…¼å®¹ï¼

# ä¿æŒç»´åº¦
norms = np.linalg.norm(arr, axis=1, keepdims=True)  # (100, 1)
# arr / norms â†’ OKï¼Œå¹¿æ’­æ­£ç¡®
```

**ç­‰ä»·äºï¼š** `norms[:, np.newaxis]`

---

### å¡ç‰‡9ï¼šå¸¸è§é”™è¯¯ âš ï¸

**é”™è¯¯1ï¼šç»´åº¦ä½ç½®æå**
```python
matrix = np.ones((3, 4))
vec = np.array([1, 2, 3])

# âŒ é”™è¯¯
matrix + vec[np.newaxis, :]  # (3,4) + (1,3) â†’ ä¸å…¼å®¹

# âœ… æ­£ç¡®
matrix + vec[:, np.newaxis]  # (3,4) + (3,1) â†’ OK
```

**é”™è¯¯2ï¼šå¿˜è®°newaxis**
```python
# âŒ èŒƒæ•°å½¢çŠ¶ä¸å¯¹
norms = np.linalg.norm(arr, axis=1)  # (N,)
arr / norms  # é”™è¯¯ï¼

# âœ… æ‰©å±•ç»´åº¦
arr / norms[:, np.newaxis]  # OK
```

---

### å¡ç‰‡10ï¼šæ€§èƒ½tips ğŸš€

**1. çŸ©é˜µä¹˜æ³•ä¼˜äºå¹¿æ’­**
```python
# æ¨è
sims = queries @ docs.T

# ä¸æ¨èï¼ˆå ç”¨æ›´å¤šå†…å­˜ï¼‰
q = queries[:, np.newaxis, :]
d = docs[np.newaxis, :, :]
sims = (q * d).sum(axis=2)
```

**2. å¤§è§„æ¨¡æ•°æ®åˆ†å—å¤„ç†**
```python
# NÂ²å†…å­˜å¯èƒ½çˆ†ç‚¸
# åˆ†å—è®¡ç®—é¿å…OOM
```

**3. ä½¿ç”¨float32**
```python
arr = arr.astype(np.float32)  # çœä¸€åŠå†…å­˜
```

---

## 10. ã€ä¸€å¥è¯æ€»ç»“ã€‘

**np.newaxisï¼ˆç­‰ä»·äºNoneï¼‰æ˜¯NumPyä¸­åœ¨æŒ‡å®šä½ç½®æ’å…¥é•¿åº¦ä¸º1çš„æ–°ç»´åº¦çš„è¯­æ³•ç³–ï¼Œé€šè¿‡åˆ›å»ºè§†å›¾è€Œéå¤åˆ¶æ•°æ®ï¼Œä»¥é›¶æˆæœ¬æ–¹å¼å¸®åŠ©æ•°ç»„æ»¡è¶³å¹¿æ’­è§„åˆ™ï¼Œæ˜¯å®ç°å‘é‡æ•°æ®åº“æ‰¹é‡å½’ä¸€åŒ–ã€æˆå¯¹è·ç¦»è®¡ç®—ã€ç›¸ä¼¼åº¦çŸ©é˜µç­‰æ“ä½œçš„æ ¸å¿ƒæŠ€å·§ã€‚**

---

## é™„å½•ï¼šå¿«é€Ÿå‚è€ƒå¡ ğŸ“‹

### æ ¸å¿ƒè¯­æ³•é€ŸæŸ¥

```python
import numpy as np

arr = np.array([1, 2, 3])  # (3,)

# ===== åŸºæœ¬ç”¨æ³• =====
arr[np.newaxis, :]    # (1, 3) è¡Œå‘é‡
arr[:, np.newaxis]    # (3, 1) åˆ—å‘é‡
arr[None, :]          # ç­‰ä»·äºnp.newaxis
arr[:, None]          # ç­‰ä»·

# ===== å¤šç»´æ‰©å±• =====
arr[np.newaxis, :, np.newaxis]  # (1, 3, 1)

# ===== å¸¸ç”¨æ¨¡å¼ =====
# æ‰¹é‡å½’ä¸€åŒ–
norms = np.linalg.norm(arr, axis=1)[:, np.newaxis]  # (N, 1)
normalized = arr / norms

# å¤–ç§¯
outer = a[:, np.newaxis] * b[np.newaxis, :]  # (m, n)

# æˆå¯¹è·ç¦»
p1 = points[:, np.newaxis, :]  # (N, 1, D)
p2 = points[np.newaxis, :, :]  # (1, N, D)
distances = np.sqrt(((p1 - p2) ** 2).sum(axis=2))

# æ‰¹é‡ç›¸ä¼¼åº¦
similarities = queries @ docs.T  # æ¨èç”¨çŸ©é˜µä¹˜æ³•
```

### å¹¿æ’­è§„åˆ™é€ŸæŸ¥

```
è§„åˆ™1ï¼šä»å³å¾€å·¦å¯¹é½
è§„åˆ™2ï¼šç»´åº¦è¦ä¹ˆç›¸ç­‰ï¼Œè¦ä¹ˆå…¶ä¸­ä¸€ä¸ªæ˜¯1
è§„åˆ™3ï¼šç¼ºå¤±ç»´åº¦è§†ä¸º1

ç¤ºä¾‹ï¼š
(3, 4) + (4,)     â†’ (3, 4) âœ…
(3, 4) + (3,)     â†’ é”™è¯¯ âŒ
(3, 4) + (3, 1)   â†’ (3, 4) âœ…
(3, 4) + (1, 4)   â†’ (3, 4) âœ…
(5, 1, 768) * (1, 1000, 768) â†’ (5, 1000, 768) âœ…
```

### å­¦ä¹ æ£€æŸ¥æ¸…å• âœ…

- [ ] ç†è§£np.newaxiså°±æ˜¯None
- [ ] æŒæ¡è¡Œå‘é‡å’Œåˆ—å‘é‡çš„åˆ›å»º
- [ ] çŸ¥é“np.newaxisè¿”å›è§†å›¾ä¸å¤åˆ¶
- [ ] ä¼šç”¨np.newaxiså¯¹é½å¹¿æ’­
- [ ] èƒ½è®¡ç®—å¤–ç§¯
- [ ] èƒ½è®¡ç®—æˆå¯¹è·ç¦»çŸ©é˜µ
- [ ] ç†è§£keepdimså‚æ•°çš„ä½œç”¨
- [ ] çŸ¥é“çŸ©é˜µä¹˜æ³•é€šå¸¸ä¼˜äºå¹¿æ’­
- [ ] èƒ½é¿å…ç»´åº¦ä½ç½®é”™è¯¯
- [ ] èƒ½åœ¨å‘é‡æ•°æ®åº“åœºæ™¯ä¸­åº”ç”¨

### ä¸‹ä¸€æ­¥å­¦ä¹  ğŸš€

æŒæ¡äº†np.newaxisåï¼Œå»ºè®®å­¦ä¹ ï¼š

1. **é«˜çº§ç´¢å¼•**ï¼šèŠ±å¼ç´¢å¼•ã€å¸ƒå°”ç´¢å¼•
2. **NumPyæ€§èƒ½ä¼˜åŒ–**ï¼šå†…å­˜å¸ƒå±€ã€cacheæ•ˆç‡
3. **å‘é‡æ•°æ®åº“å®æˆ˜**ï¼šMilvusã€Faiss

**å­¦ä¹ è·¯å¾„ï¼š**
```
NumPyæ•°ç»„åˆ›å»º
    â†“
å‘é‡åŒ–è¿ç®—
    â†“
å¹¿æ’­æœºåˆ¶åŸºç¡€
    â†“
å‘é‡æ•°æ®åº“å½’ä¸€åŒ–
    â†“
å¹¿æ’­æœºåˆ¶ä¸np.newaxisï¼ˆå½“å‰ï¼‰âœ…
    â†“
å‘é‡æ•°æ®åº“å®æˆ˜
```

---

## å‚è€ƒèµ„æº ğŸ“š

1. **NumPyå¹¿æ’­æ–‡æ¡£**ï¼šhttps://numpy.org/doc/stable/user/basics.broadcasting.html
2. **NumPy newaxisæ–‡æ¡£**ï¼šhttps://numpy.org/doc/stable/reference/constants.html#numpy.newaxis
3. **NumPyç´¢å¼•æ–‡æ¡£**ï¼šhttps://numpy.org/doc/stable/user/basics.indexing.html
4. **é«˜æ•ˆNumPy**ï¼šhttps://numpy.org/doc/stable/user/quickstart.html

---

**ç»“è¯­ï¼š** np.newaxisè™½å°ï¼Œå´æ˜¯NumPyå¹¿æ’­çš„å…³é”®å·¥å…·ã€‚æŒæ¡äº†å®ƒï¼Œä½ å°±èƒ½ä¼˜é›…åœ°å¤„ç†å„ç§ç»´åº¦å¯¹é½é—®é¢˜ï¼Œå®ç°é«˜æ•ˆçš„æ‰¹é‡è®¡ç®—ã€‚åœ¨å‘é‡æ•°æ®åº“çš„ä¸–ç•Œé‡Œï¼Œè¿™æ˜¯å¿…å¤‡æŠ€èƒ½ï¼ç»§ç»­åŠ æ²¹ï¼ğŸ’ª
