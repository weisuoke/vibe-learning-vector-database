# æ··åˆæŸ¥è¯¢ï¼šå‘é‡æœç´¢ + æ ‡é‡è¿‡æ»¤

## 1. ã€30å­—æ ¸å¿ƒã€‘

**æ··åˆæŸ¥è¯¢æ˜¯å‘é‡ç›¸ä¼¼æœç´¢ä¸æ ‡é‡æ¡ä»¶è¿‡æ»¤çš„ç»“åˆï¼Œå®ç°"è¯­ä¹‰ç›¸å…³ä¸”ç¬¦åˆä¸šåŠ¡æ¡ä»¶"çš„ç²¾å‡†æ£€ç´¢ã€‚**

---

## 2. ã€ç¬¬ä¸€æ€§åŸç†ã€‘

### ä»€ä¹ˆæ˜¯ç¬¬ä¸€æ€§åŸç†ï¼Ÿ

**ç¬¬ä¸€æ€§åŸç†**ï¼šå›åˆ°äº‹ç‰©æœ€åŸºæœ¬çš„çœŸç†ï¼Œä»æºå¤´æ€è€ƒé—®é¢˜

### æ··åˆæŸ¥è¯¢çš„ç¬¬ä¸€æ€§åŸç† ğŸ¯

#### 1. æœ€åŸºç¡€çš„å®šä¹‰

**æ··åˆæŸ¥è¯¢ = å‘é‡æœç´¢ï¼ˆè¯­ä¹‰ç›¸ä¼¼ï¼‰ + æ ‡é‡è¿‡æ»¤ï¼ˆæ¡ä»¶ç­›é€‰ï¼‰**

ä»…æ­¤è€Œå·²ï¼æ²¡æœ‰æ›´åŸºç¡€çš„äº†ã€‚

- **å‘é‡æœç´¢**ï¼šæ‰¾åˆ°è¯­ä¹‰ä¸Šæœ€ç›¸å…³çš„å†…å®¹
- **æ ‡é‡è¿‡æ»¤**ï¼šæŒ‰ä¸šåŠ¡æ¡ä»¶ï¼ˆä»·æ ¼ã€æ—¥æœŸã€ç±»åˆ«ç­‰ï¼‰ç­›é€‰

#### 2. ä¸ºä»€ä¹ˆéœ€è¦æ··åˆæŸ¥è¯¢ï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šçº¯å‘é‡æœç´¢æ— æ³•æ»¡è¶³å¤æ‚ä¸šåŠ¡éœ€æ±‚**

æƒ³è±¡ä¸€ä¸ªç”µå•†æœç´¢åœºæ™¯ï¼š
- ç”¨æˆ·æœç´¢"è½»è–„ç¬”è®°æœ¬"
- çº¯å‘é‡æœç´¢ï¼šè¿”å›æ‰€æœ‰è¯­ä¹‰ç›¸å…³çš„ç¬”è®°æœ¬
- ä½†ç”¨æˆ·è¿˜æƒ³è¦ï¼šä»·æ ¼ < 5000ï¼Œå“ç‰Œ = è”æƒ³ï¼Œæœ‰è´§

è¿™æ—¶å€™éœ€è¦**æ··åˆæŸ¥è¯¢**ï¼š
```
è¯­ä¹‰ç›¸å…³ï¼ˆå‘é‡æœç´¢ï¼‰+ ä»·æ ¼<5000ï¼ˆæ ‡é‡è¿‡æ»¤ï¼‰+ å“ç‰Œ=è”æƒ³ï¼ˆæ ‡é‡è¿‡æ»¤ï¼‰
```

#### 3. æ··åˆæŸ¥è¯¢çš„ä¸‰å±‚ä»·å€¼

##### ä»·å€¼1ï¼šç²¾å‡†æ£€ç´¢
åŒæ—¶æ»¡è¶³è¯­ä¹‰ç›¸å…³å’Œä¸šåŠ¡æ¡ä»¶ï¼Œç»“æœæ›´ç²¾å‡†ã€‚

##### ä»·å€¼2ï¼šçµæ´»æ€§
æ”¯æŒä¸°å¯Œçš„è¿‡æ»¤æ¡ä»¶ï¼ˆæ¯”è¾ƒã€èŒƒå›´ã€é›†åˆã€é€»è¾‘ç»„åˆï¼‰ã€‚

##### ä»·å€¼3ï¼šæ€§èƒ½ä¼˜åŒ–
è¿‡æ»¤æ¡ä»¶å¯ä»¥å‡å°‘å‘é‡æœç´¢çš„å€™é€‰é›†ï¼Œæé«˜æ•ˆç‡ã€‚

#### 4. ä»ç¬¬ä¸€æ€§åŸç†æ¨å¯¼æ··åˆæŸ¥è¯¢

**æ¨ç†é“¾ï¼š**
```
1. ç”¨æˆ·æœ‰è¯­ä¹‰éœ€æ±‚ï¼ˆ"è½»è–„ç¬”è®°æœ¬"ï¼‰
   â†“
2. ç”¨æˆ·æœ‰ä¸šåŠ¡çº¦æŸï¼ˆä»·æ ¼ã€å“ç‰Œã€åº“å­˜ï¼‰
   â†“
3. çº¯å‘é‡æœç´¢åªèƒ½æ»¡è¶³è¯­ä¹‰éœ€æ±‚
   â†“
4. çº¯æ ‡é‡æŸ¥è¯¢åªèƒ½æ»¡è¶³ä¸šåŠ¡çº¦æŸ
   â†“
5. éœ€è¦ä¸¤è€…ç»“åˆ = æ··åˆæŸ¥è¯¢
   â†“
6. å…ˆå‘é‡æœç´¢æ‰¾å€™é€‰ï¼Œå†æ ‡é‡è¿‡æ»¤ç²¾ç­›ï¼ˆæˆ–åè¿‡æ¥ï¼‰
```

#### 5. ä¸€å¥è¯æ€»ç»“ç¬¬ä¸€æ€§åŸç†

**æ··åˆæŸ¥è¯¢æ˜¯å‘é‡æ•°æ®åº“çš„æ€æ‰‹çº§ç‰¹æ€§ï¼Œè®©æ£€ç´¢æ—¢æ‡‚è¯­ä¹‰åˆæ‡‚ä¸šåŠ¡ã€‚**

---

## 3. ã€3ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‘

### æ ¸å¿ƒæ¦‚å¿µ1ï¼šFilter è¡¨è¾¾å¼ ğŸ”§

**Filter æ˜¯æ ‡é‡è¿‡æ»¤çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œè¯­æ³•ç±»ä¼¼ SQL çš„ WHERE å­å¥ã€‚**

```python
from pymilvus import MilvusClient

client = MilvusClient(uri="http://localhost:19530")

# åŸºç¡€è¿‡æ»¤
results = client.search(
    collection_name="products",
    data=[query_vector],
    filter="price < 5000",  # ä»·æ ¼å°äº5000
    limit=10
)

# å¤åˆè¿‡æ»¤
results = client.search(
    collection_name="products",
    data=[query_vector],
    filter="price < 5000 and category == 'electronics' and brand in ['Apple', 'Dell']",
    limit=10
)
```

**Filter æ”¯æŒçš„æ“ä½œç¬¦ï¼š**

| ç±»å‹ | æ“ä½œç¬¦ | ç¤ºä¾‹ |
|------|--------|------|
| æ¯”è¾ƒ | `>`, `>=`, `<`, `<=`, `==`, `!=` | `price > 100` |
| èŒƒå›´ | `in`, `not in` | `brand in ['Apple', 'Dell']` |
| é€»è¾‘ | `and`, `or`, `not` | `price < 100 and stock > 0` |
| å­—ç¬¦ä¸² | `like` | `title like "Python%"` |
| æ•°ç»„ | `array_contains` | `tags array_contains 'AI'` |

**åœ¨å‘é‡æ•°æ®åº“ä¸­çš„åº”ç”¨ï¼š**
RAG ç³»ç»Ÿä¸­ï¼Œå¯ä»¥æŒ‰æ–‡æ¡£æ¥æºã€æ—¶é—´èŒƒå›´ã€æƒé™çº§åˆ«è¿‡æ»¤æ£€ç´¢ç»“æœã€‚

---

### æ ¸å¿ƒæ¦‚å¿µ2ï¼šè¿‡æ»¤ç­–ç•¥ï¼ˆPre-filter vs Post-filterï¼‰ ğŸ¯

**Milvus æ”¯æŒä¸¤ç§è¿‡æ»¤ç­–ç•¥ï¼šå…ˆè¿‡æ»¤åæœç´¢ï¼ˆPre-filterï¼‰å’Œå…ˆæœç´¢åè¿‡æ»¤ï¼ˆPost-filterï¼‰ã€‚**

```
Pre-filterï¼ˆå…ˆè¿‡æ»¤ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¨éƒ¨æ•°æ®       â”‚ â†’ â”‚ æ ‡é‡è¿‡æ»¤        â”‚ â†’ â”‚ å‘é‡æœç´¢        â”‚
â”‚  1000000 æ¡     â”‚    â”‚ ç­›é€‰å‡º 10000 æ¡ â”‚    â”‚ Top-K ç»“æœ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Post-filterï¼ˆå…ˆæœç´¢ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¨éƒ¨æ•°æ®       â”‚ â†’ â”‚ å‘é‡æœç´¢        â”‚ â†’ â”‚ æ ‡é‡è¿‡æ»¤        â”‚
â”‚  1000000 æ¡     â”‚    â”‚ æ‰¾å‡º 1000 å€™é€‰  â”‚    â”‚ ç­›é€‰æœ€ç»ˆç»“æœ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»€ä¹ˆæ—¶å€™ç”¨å“ªç§ï¼Ÿ**
- **Pre-filter**ï¼šè¿‡æ»¤æ¡ä»¶é€‰æ‹©æ€§å¼ºï¼ˆå¤§å¹…å‡å°‘å€™é€‰é›†ï¼‰
- **Post-filter**ï¼šè¿‡æ»¤æ¡ä»¶é€‰æ‹©æ€§å¼±ï¼ˆå¤§éƒ¨åˆ†æ•°æ®éƒ½æ»¡è¶³ï¼‰

```python
# Milvus é»˜è®¤è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç­–ç•¥
# ä¹Ÿå¯ä»¥é€šè¿‡ search_params æŒ‡å®š
results = client.search(
    collection_name="products",
    data=[query_vector],
    filter="category == 'rare_category'",  # é€‰æ‹©æ€§å¼º â†’ Pre-filter
    limit=10,
)
```

**åœ¨å‘é‡æ•°æ®åº“ä¸­çš„åº”ç”¨ï¼š**
ç†è§£è¿‡æ»¤ç­–ç•¥æœ‰åŠ©äºä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¤§æ•°æ®é‡åœºæ™¯ã€‚

---

### æ ¸å¿ƒæ¦‚å¿µ3ï¼šæ ‡é‡ç´¢å¼• ğŸ“Š

**ä¸ºæ ‡é‡å­—æ®µåˆ›å»ºç´¢å¼•ï¼Œå¯ä»¥å¤§å¹…æå‡è¿‡æ»¤æ€§èƒ½ã€‚**

```python
from pymilvus import Collection, connections

connections.connect(host="localhost", port="19530")
collection = Collection("products")

# ä¸ºæ ‡é‡å­—æ®µåˆ›å»ºç´¢å¼•
collection.create_index(
    field_name="category",
    index_name="category_index"
)

collection.create_index(
    field_name="price",
    index_name="price_index"
)

# æŸ¥çœ‹ç´¢å¼•
print(collection.indexes)
```

**æ”¯æŒçš„æ ‡é‡ç´¢å¼•ç±»å‹ï¼š**

| å­—æ®µç±»å‹ | æ¨èç´¢å¼• | é€‚ç”¨åœºæ™¯ |
|----------|----------|----------|
| INT64/FLOAT | STL_SORT | èŒƒå›´æŸ¥è¯¢ |
| VARCHAR | Trie | ç²¾ç¡®åŒ¹é…ã€å‰ç¼€æŸ¥è¯¢ |
| BOOL | é»˜è®¤ | å¸ƒå°”è¿‡æ»¤ |

**åœ¨å‘é‡æ•°æ®åº“ä¸­çš„åº”ç”¨ï¼š**
ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯¹å¸¸ç”¨çš„è¿‡æ»¤å­—æ®µï¼ˆå¦‚ categoryã€user_idï¼‰å»ºç«‹ç´¢å¼•æ˜¯å¿…é¡»çš„ã€‚

---

## 4. ã€æœ€å°å¯ç”¨ã€‘

æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½ä½¿ç”¨æ··åˆæŸ¥è¯¢ï¼š

### 4.1 åˆ›å»ºæ”¯æŒè¿‡æ»¤çš„ Collection

```python
from pymilvus import MilvusClient, DataType

client = MilvusClient(uri="http://localhost:19530")

# åˆ›å»º Schemaï¼ˆåŒ…å«æ ‡é‡å­—æ®µï¼‰
schema = client.create_schema(auto_id=True, enable_dynamic_field=True)

schema.add_field("id", DataType.INT64, is_primary=True)
schema.add_field("embedding", DataType.FLOAT_VECTOR, dim=128)
schema.add_field("category", DataType.VARCHAR, max_length=64)
schema.add_field("price", DataType.FLOAT)
schema.add_field("in_stock", DataType.BOOL)

# åˆ›å»º Collection
client.create_collection(
    collection_name="products",
    schema=schema
)
```

### 4.2 æ’å…¥å¸¦å…ƒæ•°æ®çš„æ•°æ®

```python
import numpy as np

data = [
    {
        "embedding": np.random.rand(128).tolist(),
        "category": "electronics",
        "price": 4999.0,
        "in_stock": True
    },
    {
        "embedding": np.random.rand(128).tolist(),
        "category": "electronics",
        "price": 6999.0,
        "in_stock": True
    },
    {
        "embedding": np.random.rand(128).tolist(),
        "category": "books",
        "price": 59.0,
        "in_stock": False
    },
]

client.insert(collection_name="products", data=data)
```

### 4.3 æ··åˆæŸ¥è¯¢ç¤ºä¾‹

```python
# åŸºç¡€æ··åˆæŸ¥è¯¢
results = client.search(
    collection_name="products",
    data=[np.random.rand(128).tolist()],
    filter="price < 5000 and in_stock == true",
    limit=10,
    output_fields=["category", "price", "in_stock"]
)

# è§£æç»“æœ
for hit in results[0]:
    print(f"ID: {hit['id']}, è·ç¦»: {hit['distance']:.4f}")
    print(f"  ç±»åˆ«: {hit['entity']['category']}")
    print(f"  ä»·æ ¼: {hit['entity']['price']}")
    print(f"  æœ‰è´§: {hit['entity']['in_stock']}")
```

### 4.4 å¸¸ç”¨è¿‡æ»¤è¡¨è¾¾å¼

```python
# 1. æ•°å€¼æ¯”è¾ƒ
filter = "price >= 100 and price <= 500"

# 2. å­—ç¬¦ä¸²åŒ¹é…
filter = "category == 'electronics'"

# 3. é›†åˆåŒ…å«
filter = "brand in ['Apple', 'Dell', 'Lenovo']"

# 4. å¸ƒå°”è¿‡æ»¤
filter = "in_stock == true"

# 5. å­—ç¬¦ä¸²æ¨¡ç³ŠåŒ¹é…
filter = "title like 'Python%'"  # ä»¥ Python å¼€å¤´

# 6. å¤åˆæ¡ä»¶
filter = "(price < 1000 or category == 'sale') and in_stock == true"
```

**è¿™äº›çŸ¥è¯†è¶³ä»¥ï¼š**
- æ„å»ºå¸¦ä¸šåŠ¡æ¡ä»¶çš„å‘é‡æ£€ç´¢
- å®ç°ç”µå•†æœç´¢ã€å†…å®¹æ¨èç­‰åœºæ™¯
- ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- ä¸º RAG ç³»ç»Ÿæ·»åŠ å…ƒæ•°æ®è¿‡æ»¤

---

## 5. ã€1ä¸ªç±»æ¯”ã€‘

### ç±»æ¯”1ï¼šæ··åˆæŸ¥è¯¢ = SQL WHERE + ORDER BY ğŸ”

**æ··åˆæŸ¥è¯¢å°±åƒ SQL ä¸­ WHERE è¿‡æ»¤ + ORDER BY æ’åºçš„ç»„åˆã€‚**

```sql
-- SQL æŸ¥è¯¢
SELECT * FROM products
WHERE price < 5000 
  AND category = 'electronics'
  AND in_stock = true
ORDER BY relevance_score DESC  -- å‡è®¾æœ‰ç›¸å…³æ€§è¯„åˆ†
LIMIT 10;
```

```python
# Milvus æ··åˆæŸ¥è¯¢
results = client.search(
    collection_name="products",
    data=[query_vector],            # è¯­ä¹‰ç›¸å…³æ€§ï¼ˆä»£æ›¿ ORDER BYï¼‰
    filter="price < 5000 and category == 'electronics' and in_stock == true",
    limit=10
)
```

**å…³é”®åŒºåˆ«ï¼š**
- SQL çš„ `ORDER BY` æ˜¯æŒ‰å­—æ®µæ’åº
- Milvus çš„ `search` æ˜¯æŒ‰å‘é‡ç›¸ä¼¼åº¦æ’åº

---

### ç±»æ¯”2ï¼šfilter = Array.filter() ğŸ”§

**Milvus çš„ filter å°±åƒ JavaScript çš„ Array.filter()ã€‚**

```javascript
// JavaScript è¿‡æ»¤
const results = products
  .filter(p => p.price < 5000)
  .filter(p => p.category === 'electronics')
  .filter(p => p.in_stock === true)
  .sort((a, b) => b.similarity - a.similarity)
  .slice(0, 10);
```

```python
# Milvus æ··åˆæŸ¥è¯¢
results = client.search(
    collection_name="products",
    data=[query_vector],
    filter="price < 5000 and category == 'electronics' and in_stock == true",
    limit=10
)
```

---

### ç±»æ¯”3ï¼šPre-filter = æ¡ä»¶æ¸²æŸ“ä¼˜åŒ– âš¡

**Pre-filter ç­–ç•¥å°±åƒ React ä¸­é¿å…ä¸å¿…è¦çš„æ¸²æŸ“ã€‚**

```jsx
// Reactï¼šå…ˆè¿‡æ»¤å†æ¸²æŸ“ï¼ˆä¼˜åŒ–æ€§èƒ½ï¼‰
function ProductList({ products, category }) {
  // å…ˆè¿‡æ»¤
  const filtered = useMemo(
    () => products.filter(p => p.category === category),
    [products, category]
  );
  
  // å†æ¸²æŸ“ï¼ˆåªæ¸²æŸ“è¿‡æ»¤åçš„æ•°æ®ï¼‰
  return filtered.map(p => <ProductCard key={p.id} {...p} />);
}
```

```python
# Milvus Pre-filterï¼šå…ˆè¿‡æ»¤å†æœç´¢
# å½“ filter é€‰æ‹©æ€§å¼ºæ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨ Pre-filter
results = client.search(
    collection_name="products",
    data=[query_vector],
    filter="category == 'rare_category'",  # åªæœ‰å°‘é‡æ•°æ®æ»¡è¶³
    limit=10
)
```

---

### ç±»æ¯”4ï¼šoutput_fields = GraphQL å­—æ®µé€‰æ‹© ğŸ“¦

**output_fields æŒ‡å®šè¿”å›å­—æ®µï¼Œå°±åƒ GraphQL åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µã€‚**

```graphql
# GraphQLï¼šåªè¯·æ±‚éœ€è¦çš„å­—æ®µ
query {
  products(filter: { price_lt: 5000 }) {
    id
    name
    price
    # ä¸è¯·æ±‚ description, images ç­‰å¤§å­—æ®µ
  }
}
```

```python
# Milvusï¼šåªè¿”å›éœ€è¦çš„å­—æ®µ
results = client.search(
    collection_name="products",
    data=[query_vector],
    filter="price < 5000",
    limit=10,
    output_fields=["id", "name", "price"]  # åªè¿”å›è¿™äº›å­—æ®µ
)
```

---

### ç±»æ¯”5ï¼šå¤åˆæ¡ä»¶ = CSS é€‰æ‹©å™¨ç»„åˆ ğŸ¨

**å¤åˆè¿‡æ»¤æ¡ä»¶å°±åƒ CSS çš„å¤åˆé€‰æ‹©å™¨ã€‚**

```css
/* CSS å¤åˆé€‰æ‹©å™¨ */
.product.electronics.in-stock[data-price]:not(.expensive) {
  display: block;
}
```

```python
# Milvus å¤åˆè¿‡æ»¤
filter = "category == 'electronics' and in_stock == true and price < 5000"
```

---

### ç±»æ¯”æ€»ç»“è¡¨

| Milvus æ¦‚å¿µ | å‰ç«¯å¯¹åº”æ¦‚å¿µ | ä½œç”¨ |
|-------------|------------|------|
| filter è¡¨è¾¾å¼ | Array.filter() | æ¡ä»¶è¿‡æ»¤ |
| å‘é‡æœç´¢ + filter | WHERE + ORDER BY | è¿‡æ»¤ + æ’åº |
| Pre-filter | useMemo ä¼˜åŒ– | å…ˆè¿‡æ»¤å‡å°‘è®¡ç®—é‡ |
| output_fields | GraphQL å­—æ®µé€‰æ‹© | åªè¿”å›éœ€è¦çš„å­—æ®µ |
| å¤åˆæ¡ä»¶ | CSS å¤åˆé€‰æ‹©å™¨ | å¤šæ¡ä»¶ç»„åˆ |
| æ ‡é‡ç´¢å¼• | æ•°æ®åº“ç´¢å¼•/è™šæ‹Ÿåˆ—è¡¨ | åŠ é€ŸæŸ¥è¯¢ |

---

## 6. ã€åç›´è§‰ç‚¹ã€‘

### è¯¯åŒº1ï¼šfilter æ¡ä»¶è¶Šå¤šè¶Šæ…¢ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- åˆç†çš„ filter å¯ä»¥**å‡å°‘**å‘é‡æœç´¢çš„å€™é€‰é›†
- Pre-filter ç­–ç•¥ä¸‹ï¼Œè¿‡æ»¤å‘ç”Ÿåœ¨å‘é‡æœç´¢ä¹‹å‰
- å€™é€‰é›†å°äº†ï¼Œå‘é‡æœç´¢åè€Œæ›´å¿«

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
ä¹ æƒ¯æ€§è®¤ä¸º"æ¡ä»¶å¤š = è®¡ç®—å¤š = æ›´æ…¢"ï¼Œä½†å‘é‡æœç´¢æ˜¯ä¸»è¦å¼€é”€ã€‚

**æ­£ç¡®ç†è§£ï¼š**
```python
# å‡è®¾æ•°æ®åº“æœ‰ 1000 ä¸‡æ¡æ•°æ®

# âŒ çº¯å‘é‡æœç´¢ï¼šæœç´¢å…¨éƒ¨ 1000 ä¸‡
results = client.search(
    collection_name="products",
    data=[query_vector],
    limit=10
)  # æœç´¢èŒƒå›´ï¼š1000 ä¸‡

# âœ… æ··åˆæŸ¥è¯¢ï¼šå…ˆè¿‡æ»¤åˆ° 10 ä¸‡ï¼Œå†å‘é‡æœç´¢
results = client.search(
    collection_name="products",
    data=[query_vector],
    filter="category == 'electronics'",  # è¿‡æ»¤ååªå‰© 10 ä¸‡
    limit=10
)  # æœç´¢èŒƒå›´ï¼š10 ä¸‡ï¼ˆå¿« 100 å€ï¼ï¼‰
```

---

### è¯¯åŒº2ï¼šæ‰€æœ‰å­—æ®µéƒ½å¯ä»¥ä½œä¸ºè¿‡æ»¤æ¡ä»¶ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- åªæœ‰åœ¨ Schema ä¸­å®šä¹‰çš„æ ‡é‡å­—æ®µæ‰èƒ½è¿‡æ»¤
- å‘é‡å­—æ®µä¸èƒ½ä½œä¸º filter æ¡ä»¶
- åŠ¨æ€å­—æ®µéœ€è¦å¼€å¯ `enable_dynamic_field`

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
è§‰å¾—æ•°æ®æ’å…¥äº†å°±èƒ½æŸ¥è¯¢ï¼Œå¿˜äº† Schema çš„çº¦æŸã€‚

**æ­£ç¡®ç†è§£ï¼š**
```python
# Schema å®šä¹‰å†³å®šäº†å“ªäº›å­—æ®µå¯ä»¥è¿‡æ»¤
schema.add_field("category", DataType.VARCHAR, max_length=64)  # âœ… å¯ä»¥è¿‡æ»¤
schema.add_field("embedding", DataType.FLOAT_VECTOR, dim=128)  # âŒ ä¸èƒ½è¿‡æ»¤

# è¿‡æ»¤æ—¶
filter = "category == 'electronics'"  # âœ… æ­£ç¡®
filter = "embedding > 0.5"            # âŒ é”™è¯¯ï¼Œå‘é‡ä¸èƒ½æ¯”è¾ƒ

# åŠ¨æ€å­—æ®µï¼ˆæœªåœ¨ Schema å®šä¹‰çš„å­—æ®µï¼‰
schema = client.create_schema(enable_dynamic_field=True)  # å¼€å¯åŠ¨æ€å­—æ®µ
# ç„¶åå¯ä»¥æ’å…¥ä»»æ„å­—æ®µ
client.insert(data=[{"embedding": [...], "custom_field": "value"}])
# å¹¶ç”¨äºè¿‡æ»¤
filter = "custom_field == 'value'"  # âœ… å¯ä»¥ï¼ˆå¼€å¯åŠ¨æ€å­—æ®µåï¼‰
```

---

### è¯¯åŒº3ï¼šæ··åˆæŸ¥è¯¢ç»“æœæ•°é‡ä¸€å®šç­‰äº limit âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- å¦‚æœæ»¡è¶³ filter æ¡ä»¶çš„æ•°æ®å°‘äº limitï¼Œè¿”å›çš„å°±å°‘
- filter å¯èƒ½è¿‡æ»¤æ‰å¤§éƒ¨åˆ†æ•°æ®
- ç»“æœæ•°é‡ = min(æ»¡è¶³æ¡ä»¶çš„æ•°é‡, limit)

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
è§‰å¾—è®¾äº† `limit=10` å°±ä¸€å®šè¿”å› 10 æ¡ã€‚

**æ­£ç¡®ç†è§£ï¼š**
```python
# å‡è®¾åªæœ‰ 3 æ¡æ•°æ®æ»¡è¶³æ¡ä»¶
results = client.search(
    collection_name="products",
    data=[query_vector],
    filter="category == 'rare_category'",  # åªæœ‰ 3 æ¡æ»¡è¶³
    limit=10  # æœŸæœ› 10 æ¡
)

# å®é™…è¿”å› 3 æ¡
print(len(results[0]))  # è¾“å‡º: 3

# å¤„ç†ç»“æœæ—¶è¦è€ƒè™‘è¿™ç§æƒ…å†µ
if len(results[0]) < expected_count:
    print("ç»“æœæ•°é‡ä¸è¶³ï¼Œè€ƒè™‘æ”¾å®½è¿‡æ»¤æ¡ä»¶")
```

---

## 7. ã€å®æˆ˜ä»£ç ã€‘

```python
"""
Milvus æ··åˆæŸ¥è¯¢å®Œæ•´å®æˆ˜ç¤ºä¾‹
æ¼”ç¤ºå‘é‡æœç´¢ä¸æ ‡é‡è¿‡æ»¤çš„ç»„åˆä½¿ç”¨
"""

from pymilvus import MilvusClient, DataType
import numpy as np

# ===== 0. è¿æ¥ Milvus =====
print("=== è¿æ¥ Milvus ===")
client = MilvusClient(uri="http://localhost:19530")
print("âœ… è¿æ¥æˆåŠŸ")

# ===== 1. åˆ›å»ºå¸¦æ ‡é‡å­—æ®µçš„ Collection =====
print("\n=== 1. åˆ›å»º Collection ===")

collection_name = "product_search"

# å¦‚æœå­˜åœ¨åˆ™åˆ é™¤
if client.has_collection(collection_name):
    client.drop_collection(collection_name)

# åˆ›å»º Schema
schema = client.create_schema(auto_id=False, enable_dynamic_field=True)
schema.add_field("id", DataType.INT64, is_primary=True)
schema.add_field("embedding", DataType.FLOAT_VECTOR, dim=128)
schema.add_field("title", DataType.VARCHAR, max_length=256)
schema.add_field("category", DataType.VARCHAR, max_length=64)
schema.add_field("price", DataType.FLOAT)
schema.add_field("rating", DataType.FLOAT)
schema.add_field("in_stock", DataType.BOOL)

# åˆ›å»ºç´¢å¼•
index_params = client.prepare_index_params()
index_params.add_index(
    field_name="embedding",
    index_type="IVF_FLAT",
    metric_type="L2",
    params={"nlist": 128}
)

# åˆ›å»º Collection
client.create_collection(
    collection_name=collection_name,
    schema=schema,
    index_params=index_params
)
print(f"âœ… åˆ›å»º Collection: {collection_name}")

# ===== 2. æ’å…¥æµ‹è¯•æ•°æ® =====
print("\n=== 2. æ’å…¥æµ‹è¯•æ•°æ® ===")

np.random.seed(42)

products = [
    {"id": 1, "title": "MacBook Pro 14å¯¸", "category": "electronics", "price": 14999, "rating": 4.8, "in_stock": True},
    {"id": 2, "title": "MacBook Air M2", "category": "electronics", "price": 9499, "rating": 4.7, "in_stock": True},
    {"id": 3, "title": "Dell XPS 15", "category": "electronics", "price": 12999, "rating": 4.5, "in_stock": False},
    {"id": 4, "title": "ThinkPad X1 Carbon", "category": "electronics", "price": 11999, "rating": 4.6, "in_stock": True},
    {"id": 5, "title": "Python ç¼–ç¨‹å…¥é—¨", "category": "books", "price": 59, "rating": 4.9, "in_stock": True},
    {"id": 6, "title": "æœºå™¨å­¦ä¹ å®æˆ˜", "category": "books", "price": 89, "rating": 4.7, "in_stock": True},
    {"id": 7, "title": "æ·±åº¦å­¦ä¹ åŸºç¡€", "category": "books", "price": 99, "rating": 4.5, "in_stock": False},
    {"id": 8, "title": "iPhone 15 Pro", "category": "electronics", "price": 8999, "rating": 4.8, "in_stock": True},
    {"id": 9, "title": "iPad Pro 12.9", "category": "electronics", "price": 9299, "rating": 4.7, "in_stock": True},
    {"id": 10, "title": "AirPods Pro 2", "category": "electronics", "price": 1899, "rating": 4.6, "in_stock": True},
    {"id": 11, "title": "æœºæ¢°é”®ç›˜ K2", "category": "accessories", "price": 599, "rating": 4.4, "in_stock": True},
    {"id": 12, "title": "äººä½“å·¥å­¦é¼ æ ‡", "category": "accessories", "price": 299, "rating": 4.3, "in_stock": True},
    {"id": 13, "title": "4K æ˜¾ç¤ºå™¨", "category": "electronics", "price": 2999, "rating": 4.5, "in_stock": False},
    {"id": 14, "title": "React æƒå¨æŒ‡å—", "category": "books", "price": 79, "rating": 4.6, "in_stock": True},
    {"id": 15, "title": "Vue.js å®æˆ˜", "category": "books", "price": 69, "rating": 4.4, "in_stock": True},
]

# ä¸ºæ¯ä¸ªäº§å“æ·»åŠ å‘é‡
data = []
for p in products:
    p["embedding"] = np.random.rand(128).tolist()
    data.append(p)

client.insert(collection_name=collection_name, data=data)
print(f"âœ… æ’å…¥ {len(data)} æ¡æ•°æ®")

# ===== 3. åŸºç¡€æ··åˆæŸ¥è¯¢ =====
print("\n=== 3. åŸºç¡€æ··åˆæŸ¥è¯¢ ===")

# æ¨¡æ‹Ÿæœç´¢"ç¬”è®°æœ¬ç”µè„‘"çš„ embedding
query_vector = np.random.rand(128).tolist()

# æœç´¢ï¼šè¯­ä¹‰ç›¸å…³ + ä»·æ ¼ < 10000 + æœ‰è´§
results = client.search(
    collection_name=collection_name,
    data=[query_vector],
    filter="price < 10000 and in_stock == true",
    limit=5,
    output_fields=["title", "category", "price", "rating", "in_stock"]
)

print("æœç´¢æ¡ä»¶: ä»·æ ¼ < 10000 ä¸”æœ‰è´§")
print("æœç´¢ç»“æœï¼š")
for hit in results[0]:
    entity = hit["entity"]
    print(f"  - {entity['title']}")
    print(f"    ä»·æ ¼: Â¥{entity['price']}, è¯„åˆ†: {entity['rating']}, æœ‰è´§: {entity['in_stock']}")
    print(f"    è·ç¦»: {hit['distance']:.4f}")

# ===== 4. åˆ†ç±»è¿‡æ»¤ =====
print("\n=== 4. åˆ†ç±»è¿‡æ»¤ ===")

# åªæœç´¢ electronics ç±»åˆ«
results = client.search(
    collection_name=collection_name,
    data=[query_vector],
    filter="category == 'electronics'",
    limit=5,
    output_fields=["title", "category", "price"]
)

print("æœç´¢æ¡ä»¶: ç±»åˆ« = electronics")
print("æœç´¢ç»“æœï¼š")
for hit in results[0]:
    entity = hit["entity"]
    print(f"  - {entity['title']} (Â¥{entity['price']})")

# ===== 5. èŒƒå›´è¿‡æ»¤ =====
print("\n=== 5. èŒƒå›´è¿‡æ»¤ ===")

# ä»·æ ¼åœ¨ 1000-5000 ä¹‹é—´
results = client.search(
    collection_name=collection_name,
    data=[query_vector],
    filter="price >= 1000 and price <= 5000",
    limit=5,
    output_fields=["title", "price"]
)

print("æœç´¢æ¡ä»¶: ä»·æ ¼ 1000-5000")
print("æœç´¢ç»“æœï¼š")
for hit in results[0]:
    entity = hit["entity"]
    print(f"  - {entity['title']} (Â¥{entity['price']})")

# ===== 6. é›†åˆè¿‡æ»¤ï¼ˆINï¼‰ =====
print("\n=== 6. é›†åˆè¿‡æ»¤ï¼ˆINï¼‰===")

# æœç´¢ç‰¹å®šç±»åˆ«
results = client.search(
    collection_name=collection_name,
    data=[query_vector],
    filter="category in ['books', 'accessories']",
    limit=5,
    output_fields=["title", "category", "price"]
)

print("æœç´¢æ¡ä»¶: ç±»åˆ« in ['books', 'accessories']")
print("æœç´¢ç»“æœï¼š")
for hit in results[0]:
    entity = hit["entity"]
    print(f"  - {entity['title']} ({entity['category']}, Â¥{entity['price']})")

# ===== 7. å¤åˆé€»è¾‘æ¡ä»¶ =====
print("\n=== 7. å¤åˆé€»è¾‘æ¡ä»¶ ===")

# (electronics ä¸” ä»·æ ¼<10000) æˆ– (books ä¸” è¯„åˆ†>4.5)
results = client.search(
    collection_name=collection_name,
    data=[query_vector],
    filter="(category == 'electronics' and price < 10000) or (category == 'books' and rating > 4.5)",
    limit=10,
    output_fields=["title", "category", "price", "rating"]
)

print("æœç´¢æ¡ä»¶: (electronics & ä»·æ ¼<10000) æˆ– (books & è¯„åˆ†>4.5)")
print("æœç´¢ç»“æœï¼š")
for hit in results[0]:
    entity = hit["entity"]
    print(f"  - {entity['title']} ({entity['category']}, Â¥{entity['price']}, â˜…{entity['rating']})")

# ===== 8. å­—ç¬¦ä¸²æ¨¡ç³ŠåŒ¹é… =====
print("\n=== 8. å­—ç¬¦ä¸²æ¨¡ç³ŠåŒ¹é… ===")

# æ ‡é¢˜åŒ…å« "Pro" çš„äº§å“
results = client.search(
    collection_name=collection_name,
    data=[query_vector],
    filter="title like '%Pro%'",  # åŒ…å« Pro
    limit=5,
    output_fields=["title", "price"]
)

print("æœç´¢æ¡ä»¶: æ ‡é¢˜åŒ…å« 'Pro'")
print("æœç´¢ç»“æœï¼š")
for hit in results[0]:
    entity = hit["entity"]
    print(f"  - {entity['title']} (Â¥{entity['price']})")

# ===== 9. ä¸ç­‰äºè¿‡æ»¤ =====
print("\n=== 9. ä¸ç­‰äºè¿‡æ»¤ ===")

# æ’é™¤ books ç±»åˆ«
results = client.search(
    collection_name=collection_name,
    data=[query_vector],
    filter="category != 'books'",
    limit=5,
    output_fields=["title", "category"]
)

print("æœç´¢æ¡ä»¶: ç±»åˆ« != 'books'")
print("æœç´¢ç»“æœï¼š")
for hit in results[0]:
    entity = hit["entity"]
    print(f"  - {entity['title']} ({entity['category']})")

# ===== 10. å®é™…åº”ç”¨åœºæ™¯ï¼šç”µå•†æœç´¢ =====
print("\n=== 10. å®é™…åº”ç”¨åœºæ™¯ï¼šç”µå•†æœç´¢ ===")

def product_search(query_embedding, category=None, min_price=None, max_price=None, 
                   min_rating=None, only_in_stock=False, limit=10):
    """ç”µå•†äº§å“æœç´¢å‡½æ•°"""
    
    # æ„å»ºè¿‡æ»¤æ¡ä»¶
    conditions = []
    
    if category:
        conditions.append(f"category == '{category}'")
    if min_price is not None:
        conditions.append(f"price >= {min_price}")
    if max_price is not None:
        conditions.append(f"price <= {max_price}")
    if min_rating is not None:
        conditions.append(f"rating >= {min_rating}")
    if only_in_stock:
        conditions.append("in_stock == true")
    
    # ç»„åˆæ¡ä»¶
    filter_expr = " and ".join(conditions) if conditions else ""
    
    # æ‰§è¡Œæœç´¢
    results = client.search(
        collection_name=collection_name,
        data=[query_embedding],
        filter=filter_expr if filter_expr else None,
        limit=limit,
        output_fields=["title", "category", "price", "rating", "in_stock"]
    )
    
    return results[0]

# æ¨¡æ‹Ÿç”¨æˆ·æœç´¢
print("ç”¨æˆ·æœç´¢: ç”µå­äº§å“ï¼Œä»·æ ¼ 5000-15000ï¼Œè¯„åˆ† 4.5+ï¼Œæœ‰è´§")
search_results = product_search(
    query_embedding=query_vector,
    category="electronics",
    min_price=5000,
    max_price=15000,
    min_rating=4.5,
    only_in_stock=True,
    limit=5
)

print("æœç´¢ç»“æœï¼š")
for hit in search_results:
    entity = hit["entity"]
    stock_status = "âœ…æœ‰è´§" if entity["in_stock"] else "âŒç¼ºè´§"
    print(f"  - {entity['title']}")
    print(f"    ä»·æ ¼: Â¥{entity['price']}, è¯„åˆ†: â˜…{entity['rating']}, {stock_status}")

# ===== 11. æ¸…ç† =====
print("\n=== 11. æ¸…ç† ===")
client.drop_collection(collection_name)
print(f"âœ… å·²åˆ é™¤ Collection: {collection_name}")

client.close()
print("âœ… è¿æ¥å·²å…³é—­")

print("\n=== æ··åˆæŸ¥è¯¢ç¤ºä¾‹å®Œæˆ ===")
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**
```
=== è¿æ¥ Milvus ===
âœ… è¿æ¥æˆåŠŸ

=== 1. åˆ›å»º Collection ===
âœ… åˆ›å»º Collection: product_search

=== 2. æ’å…¥æµ‹è¯•æ•°æ® ===
âœ… æ’å…¥ 15 æ¡æ•°æ®

=== 3. åŸºç¡€æ··åˆæŸ¥è¯¢ ===
æœç´¢æ¡ä»¶: ä»·æ ¼ < 10000 ä¸”æœ‰è´§
æœç´¢ç»“æœï¼š
  - MacBook Air M2
    ä»·æ ¼: Â¥9499, è¯„åˆ†: 4.7, æœ‰è´§: True
    è·ç¦»: 5.2341
  - iPhone 15 Pro
    ä»·æ ¼: Â¥8999, è¯„åˆ†: 4.8, æœ‰è´§: True
    è·ç¦»: 5.4521
  ...

=== 4. åˆ†ç±»è¿‡æ»¤ ===
æœç´¢æ¡ä»¶: ç±»åˆ« = electronics
æœç´¢ç»“æœï¼š
  - MacBook Air M2 (Â¥9499)
  - MacBook Pro 14å¯¸ (Â¥14999)
  ...

=== 10. å®é™…åº”ç”¨åœºæ™¯ï¼šç”µå•†æœç´¢ ===
ç”¨æˆ·æœç´¢: ç”µå­äº§å“ï¼Œä»·æ ¼ 5000-15000ï¼Œè¯„åˆ† 4.5+ï¼Œæœ‰è´§
æœç´¢ç»“æœï¼š
  - MacBook Air M2
    ä»·æ ¼: Â¥9499, è¯„åˆ†: â˜…4.7, âœ…æœ‰è´§
  - ThinkPad X1 Carbon
    ä»·æ ¼: Â¥11999, è¯„åˆ†: â˜…4.6, âœ…æœ‰è´§
  ...

=== æ··åˆæŸ¥è¯¢ç¤ºä¾‹å®Œæˆ ===
```

---

## 8. ã€é¢è¯•å¿…é—®ã€‘

### é—®é¢˜ï¼š"ä»€ä¹ˆæ˜¯æ··åˆæŸ¥è¯¢ï¼Ÿå®ƒå’Œçº¯å‘é‡æœç´¢æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"æ··åˆæŸ¥è¯¢å°±æ˜¯å‘é‡æœç´¢åŠ ä¸Š where æ¡ä»¶è¿‡æ»¤ã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **æ··åˆæŸ¥è¯¢æ˜¯å‘é‡æœç´¢ä¸æ ‡é‡è¿‡æ»¤çš„ç»“åˆï¼š**
>
> 1. **çº¯å‘é‡æœç´¢**
>    - åªè€ƒè™‘è¯­ä¹‰ç›¸ä¼¼åº¦
>    - è¿”å›"æœ€ç›¸å…³"çš„ç»“æœ
>    - æ— æ³•æ»¡è¶³ä¸šåŠ¡çº¦æŸï¼ˆä»·æ ¼ã€ç±»åˆ«ã€æƒé™ç­‰ï¼‰
>
> 2. **æ··åˆæŸ¥è¯¢**
>    - å‘é‡æœç´¢ï¼šä¿è¯è¯­ä¹‰ç›¸å…³
>    - æ ‡é‡è¿‡æ»¤ï¼šæ»¡è¶³ä¸šåŠ¡æ¡ä»¶
>    - ç»“æœæ—¢"ç›¸å…³"åˆ"åˆè§„"
>
> **å®ç°æœºåˆ¶æœ‰ä¸¤ç§ç­–ç•¥ï¼š**
> - **Pre-filter**ï¼šå…ˆè¿‡æ»¤ï¼Œå†å‘é‡æœç´¢ï¼ˆé€‚åˆé«˜é€‰æ‹©æ€§è¿‡æ»¤ï¼‰
> - **Post-filter**ï¼šå…ˆæœç´¢ï¼Œå†è¿‡æ»¤ï¼ˆé€‚åˆä½é€‰æ‹©æ€§è¿‡æ»¤ï¼‰
>
> **æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼š**
> 1. å¯¹å¸¸ç”¨è¿‡æ»¤å­—æ®µå»ºç«‹æ ‡é‡ç´¢å¼•
> 2. åˆ©ç”¨é«˜é€‰æ‹©æ€§è¿‡æ»¤å‡å°‘å€™é€‰é›†
> 3. åˆç†è®¾ç½® limitï¼Œé¿å…è¿”å›è¿‡å¤šæ•°æ®
>
> **åœ¨å®é™…é¡¹ç›®ä¸­**ï¼Œæˆ‘ä»¬çš„ RAG ç³»ç»Ÿç”¨æ··åˆæŸ¥è¯¢å®ç°äº†"æŒ‰éƒ¨é—¨æƒé™æ£€ç´¢æ–‡æ¡£"â€”â€”å‘é‡æœç´¢æ‰¾åˆ°è¯­ä¹‰ç›¸å…³çš„å†…å®¹ï¼Œfilter ç¡®ä¿ç”¨æˆ·åªèƒ½çœ‹åˆ°æœ‰æƒé™çš„æ–‡æ¡£ã€‚

**ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©ï¼Ÿ**
1. âœ… æ¸…æ™°å¯¹æ¯”çº¯å‘é‡æœç´¢å’Œæ··åˆæŸ¥è¯¢
2. âœ… è§£é‡Šäº†åº•å±‚å®ç°æœºåˆ¶
3. âœ… ç»™å‡ºäº†æ€§èƒ½ä¼˜åŒ–å»ºè®®
4. âœ… æœ‰å®é™…é¡¹ç›®åº”ç”¨ç»éªŒ

---

## 9. ã€åŒ–éª¨ç»µæŒã€‘

### å¡ç‰‡1ï¼šä»€ä¹ˆæ˜¯æ··åˆæŸ¥è¯¢ï¼Ÿ ğŸ”€

**ä¸€å¥è¯ï¼š** æ··åˆæŸ¥è¯¢ = å‘é‡æœç´¢ï¼ˆè¯­ä¹‰ç›¸å…³ï¼‰+ æ ‡é‡è¿‡æ»¤ï¼ˆæ¡ä»¶ç­›é€‰ï¼‰ã€‚

**ä¸¾ä¾‹ï¼š**
```python
results = client.search(
    data=[query_vector],           # å‘é‡æœç´¢
    filter="price < 5000",         # æ ‡é‡è¿‡æ»¤
    limit=10
)
```

**åº”ç”¨ï¼š** ç”µå•†æœç´¢ã€RAG æƒé™æ§åˆ¶ã€æ¨èç³»ç»Ÿã€‚

---

### å¡ç‰‡2ï¼šFilter è¡¨è¾¾å¼è¯­æ³• ğŸ“

**ä¸€å¥è¯ï¼š** Filter ä½¿ç”¨ç±» SQL è¯­æ³•ï¼Œæ”¯æŒæ¯”è¾ƒã€èŒƒå›´ã€é€»è¾‘è¿ç®—ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# æ¯”è¾ƒ: ==, !=, >, <, >=, <=
filter = "price > 100"

# èŒƒå›´: in, not in
filter = "category in ['A', 'B']"

# é€»è¾‘: and, or, not
filter = "price < 100 and stock > 0"
```

**åº”ç”¨ï¼š** æ„å»ºå¤æ‚çš„ä¸šåŠ¡è¿‡æ»¤æ¡ä»¶ã€‚

---

### å¡ç‰‡3ï¼šæ•°å€¼è¿‡æ»¤ ğŸ”¢

**ä¸€å¥è¯ï¼š** æ”¯æŒæ•°å€¼å­—æ®µçš„æ¯”è¾ƒå’ŒèŒƒå›´è¿‡æ»¤ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# å•æ¡ä»¶
filter = "price < 5000"

# èŒƒå›´
filter = "price >= 1000 and price <= 5000"
```

**åº”ç”¨ï¼š** ä»·æ ¼åŒºé—´ã€è¯„åˆ†ç­›é€‰ã€æ•°é‡é™åˆ¶ã€‚

---

### å¡ç‰‡4ï¼šå­—ç¬¦ä¸²è¿‡æ»¤ ğŸ“„

**ä¸€å¥è¯ï¼š** æ”¯æŒç²¾ç¡®åŒ¹é…ã€é›†åˆåŒ¹é…ã€æ¨¡ç³ŠåŒ¹é…ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# ç²¾ç¡®åŒ¹é…
filter = "category == 'electronics'"

# é›†åˆåŒ¹é…
filter = "brand in ['Apple', 'Dell']"

# æ¨¡ç³ŠåŒ¹é…
filter = "title like '%Python%'"
```

**åº”ç”¨ï¼š** ç±»åˆ«ç­›é€‰ã€å“ç‰Œè¿‡æ»¤ã€å…³é”®è¯æœç´¢ã€‚

---

### å¡ç‰‡5ï¼šå¸ƒå°”è¿‡æ»¤ âœ“

**ä¸€å¥è¯ï¼š** å¸ƒå°”å­—æ®µä½¿ç”¨ true/false è¿›è¡Œè¿‡æ»¤ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# æœ‰è´§å•†å“
filter = "in_stock == true"

# å·²å‘å¸ƒæ–‡ç« 
filter = "is_published == true"
```

**åº”ç”¨ï¼š** åº“å­˜çŠ¶æ€ã€å‘å¸ƒçŠ¶æ€ã€å®¡æ ¸çŠ¶æ€ã€‚

---

### å¡ç‰‡6ï¼šå¤åˆæ¡ä»¶ ğŸ”—

**ä¸€å¥è¯ï¼š** ç”¨ and/or/not å’Œæ‹¬å·ç»„åˆå¤šä¸ªæ¡ä»¶ã€‚

**ä¸¾ä¾‹ï¼š**
```python
# ç»„åˆæ¡ä»¶
filter = "(price < 1000 or on_sale == true) and in_stock == true"

# æ’é™¤æ¡ä»¶
filter = "category != 'test' and not (price > 10000)"
```

**åº”ç”¨ï¼š** å¤æ‚ä¸šåŠ¡è§„åˆ™ã€å¤šç»´åº¦ç­›é€‰ã€‚

---

### å¡ç‰‡7ï¼šPre-filter vs Post-filter âš¡

**ä¸€å¥è¯ï¼š** Pre-filter å…ˆè¿‡æ»¤åæœç´¢ï¼ŒPost-filter å…ˆæœç´¢åè¿‡æ»¤ã€‚

**ä¸¾ä¾‹ï¼š**
```
Pre-filterï¼š1000ä¸‡ â†’ è¿‡æ»¤ â†’ 10ä¸‡ â†’ å‘é‡æœç´¢ â†’ ç»“æœ
Post-filterï¼š1000ä¸‡ â†’ å‘é‡æœç´¢ â†’ 1000 â†’ è¿‡æ»¤ â†’ ç»“æœ
```

**åº”ç”¨ï¼š** Milvus è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç­–ç•¥ã€‚

---

### å¡ç‰‡8ï¼šæ ‡é‡ç´¢å¼• ğŸ“Š

**ä¸€å¥è¯ï¼š** ä¸ºå¸¸ç”¨è¿‡æ»¤å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚

**ä¸¾ä¾‹ï¼š**
```python
collection.create_index(
    field_name="category",
    index_name="category_idx"
)
```

**åº”ç”¨ï¼š** ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¸ºé«˜é¢‘è¿‡æ»¤å­—æ®µå»ºç´¢å¼•ã€‚

---

### å¡ç‰‡9ï¼šoutput_fields è¿”å›å­—æ®µ ğŸ“¦

**ä¸€å¥è¯ï¼š** æŒ‡å®šè¿”å›å“ªäº›å­—æ®µï¼Œå‡å°‘æ•°æ®ä¼ è¾“ã€‚

**ä¸¾ä¾‹ï¼š**
```python
results = client.search(
    ...,
    output_fields=["title", "price"]  # åªè¿”å›è¿™äº›å­—æ®µ
)
```

**åº”ç”¨ï¼š** ä¼˜åŒ–ç½‘ç»œä¼ è¾“ï¼Œåªè·å–éœ€è¦çš„æ•°æ®ã€‚

---

### å¡ç‰‡10ï¼šå®æˆ˜æœ€ä½³å®è·µ âœ¨

**ä¸€å¥è¯ï¼š** åˆç†ä½¿ç”¨è¿‡æ»¤å¯ä»¥å¤§å¹…æå‡æœç´¢æ•ˆç‡å’Œç»“æœè´¨é‡ã€‚

**ä¸¾ä¾‹ï¼š**
```
âœ… é«˜é€‰æ‹©æ€§è¿‡æ»¤æ”¾å‰é¢
âœ… ä¸ºå¸¸ç”¨å­—æ®µå»ºç´¢å¼•
âœ… åªè¿”å›éœ€è¦çš„å­—æ®µ
âŒ è¿‡æ»¤æ¡ä»¶è¿‡äºå®½æ¾
âŒ å¿˜è®°å¤„ç†ç»“æœæ•°é‡ä¸è¶³
```

**åº”ç”¨ï¼š** ç”Ÿäº§ç¯å¢ƒæ€§èƒ½ä¼˜åŒ–çš„å…³é”®ã€‚

---

## 10. ã€ä¸€å¥è¯æ€»ç»“ã€‘

**æ··åˆæŸ¥è¯¢å°†å‘é‡ç›¸ä¼¼æœç´¢ä¸æ ‡é‡æ¡ä»¶è¿‡æ»¤ç»“åˆï¼Œé€šè¿‡ filter è¡¨è¾¾å¼å®ç°"è¯­ä¹‰ç›¸å…³ä¸”ç¬¦åˆä¸šåŠ¡è§„åˆ™"çš„ç²¾å‡†æ£€ç´¢ï¼Œæ˜¯æ„å»ºæ™ºèƒ½æœç´¢ç³»ç»Ÿçš„æ ¸å¿ƒèƒ½åŠ›ã€‚**

---

## ğŸ“š å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£æ··åˆæŸ¥è¯¢çš„æ¦‚å¿µå’Œä»·å€¼
- [ ] æŒæ¡ filter è¡¨è¾¾å¼è¯­æ³•
- [ ] èƒ½ä½¿ç”¨æ•°å€¼ã€å­—ç¬¦ä¸²ã€å¸ƒå°”è¿‡æ»¤
- [ ] èƒ½ç»„åˆå¤æ‚çš„è¿‡æ»¤æ¡ä»¶
- [ ] ç†è§£ Pre-filter å’Œ Post-filter çš„åŒºåˆ«
- [ ] çŸ¥é“ä½•æ—¶éœ€è¦å»ºç«‹æ ‡é‡ç´¢å¼•

## ğŸ”— ä¸‹ä¸€æ­¥å­¦ä¹ 

æ­å–œå®Œæˆ Milvus å®æˆ˜å…¨éƒ¨ 4 ä¸ªçŸ¥è¯†ç‚¹ï¼æ¥ä¸‹æ¥å¯ä»¥ï¼š
- å­¦ä¹  **ç´¢å¼•ç±»å‹**ï¼Œäº†è§£ IVFã€HNSW ç­‰ç´¢å¼•çš„åŸç†å’Œé€‰æ‹©
- å­¦ä¹  **æ€§èƒ½è°ƒä¼˜**ï¼ŒæŒæ¡å¤§è§„æ¨¡æ•°æ®çš„ä¼˜åŒ–æŠ€å·§
- å®æˆ˜ **RAG ç³»ç»Ÿ**ï¼ŒæŠŠæ‰€å­¦çŸ¥è¯†åº”ç”¨åˆ°å®é™…é¡¹ç›®

## ğŸ“– å‚è€ƒèµ„æº

- [Milvus Filter å®˜æ–¹æ–‡æ¡£](https://milvus.io/docs/boolean.md)
- [æ ‡é‡ç´¢å¼•](https://milvus.io/docs/scalar_index.md)
- [æœç´¢å‚æ•°è¯¦è§£](https://milvus.io/docs/search.md)
